<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Line drawing function/sv</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Line_drawing_function.html" lang="id" title="Line drawing function (3% translated)">Bahasa Indonesia</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Line_drawing_function.html" lang="de" title="Linienzeichnungsfunktion (100% translated)">Deutsch</a></li>
<li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Line_drawing_function.html" lang="en" title="Line drawing function (100% translated)">English</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Line_drawing_function.html" lang="tr" title="Line drawing function (3% translated)">Türkçe</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Line_drawing_function.html" lang="es" title="Line drawing function (12% translated)">español</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Line_drawing_function.html" lang="fr" title="Fonction - tracer une ligne (100% translated)">français</a></li>
<li><a class="mw-pt-progress mw-pt-progress--low" dir="ltr" href="Line_drawing_function.html" lang="it" title="Funzione per disegnare delle linee (35% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Line_drawing_function.html" lang="pl" title="Funkcja rysowania linii (100% translated)">polski</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Line_drawing_function.html" lang="ro" title="Funcția de Desenare a liniei (12% translated)">română</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--stub" dir="ltr" lang="sv">svenska</span></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Line_drawing_function.html" lang="cs" title="Line drawing function (3% translated)">čeština</a></li>
<li><a class="mw-pt-progress mw-pt-progress--low" dir="ltr" href="Line_drawing_function.html" lang="ru" title="Функция рисования линии (28% translated)">русский</a></li></ul></div>
<div style="clear:right; margin-bottom: .5em; float: right; padding: .5em 0 .8em 1.4em; background: none;"><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Huvudskriptet"><span class="tocnumber">2</span> <span class="toctext">Huvudskriptet</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Detaljerad_förklaring"><span class="tocnumber">3</span> <span class="toctext">Detaljerad förklaring</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Testa_&amp;_använda_skriptet"><span class="tocnumber">4</span> <span class="toctext">Testa &amp; använda skriptet</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Registrera_skriptet_i_FreeCAD's_gränssnitt"><span class="tocnumber">5</span> <span class="toctext">Registrera skriptet i FreeCAD's gränssnitt</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Så_du_vill_ha_mer?"><span class="tocnumber">6</span> <span class="toctext">Så du vill ha mer?</span></a></li>
</ul>
</div>
</div>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<div class="mw-translate-fuzzy">
<p>Denna sida visar hur lätt avancerad funktionalitet kan byggas i Python. I denna övning, så kommer vi att bygga ett nytt verktyg som ritar en linje. Detta verktyg kan sedan länkas till ett FreeCAD kommando, och det kommandot kan anropas av ett element i gränssnittet, som en menypunkt eller en knapp i en verktygslåda.
</p>
</div>
<p><span id="The_main_script"></span>
</p>
<div class="mw-translate-fuzzy">
<h2><span class="mw-headline" id="Huvudskriptet">Huvudskriptet</span></h2>
<p>Först kommer vi att skriva ett skript som innehåller all vår funktionalitet. Sedan kommer vi att spara detta i en fil, och importera den i FreeCAD, så att alla klasser och funktioner som vi skriver kommer att vara tillgängliga för FreeCAD. Så, starta din favorit textredigerare, , och skriv följande rader:
</p>
</div>
<p>First we will write a script containing all our functionality. Then we will save this in a file and import it in FreeCAD to make all its classes and functions available. Launch your favorite code editor and type the following lines:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCADGui</span><span class="o">,</span> <span class="nn">Part</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">line</span><span class="p">:</span>

    <span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event_cb</span><span class="o">.</span><span class="n">getEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
                <span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
<p><a href="#top">Top</a></p>
<p><span id="Detailed_explanation"></span>
</p>
<h2><span id="Detaljerad_f.C3.B6rklaring"></span><span class="mw-headline" id="Detaljerad_förklaring">Detaljerad förklaring</span></h2>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">Part</span><span class="o">,</span> <span class="nn">FreeCADGui</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>När du vill använda funktioner från en annan modul I Python, så behöver du importera den. I vårt fall, så behöver vi funktioner från <a href="Part_Workbench.html" title="Part Workbench/sv">Del Modulen</a>, för att skapa linjen, och från gränssnittsmodulen (FreeCADGui), för att komma åt 3D vyn. Vi behöver även innehållet i coin biblioteket, så vi kan använda alla coin objekt som SoMouseButtonEvent, etc...
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">line</span><span class="p">:</span>
</pre></div>
<p>Här definierar vi vår huvudklass. Varför använder vi en klass och inte en funktion? Skälet är att vårt verktyg behöver "stanna vid liv" medan vi väntar på att användaren ska klicka på skärmen. En funktion avslutas när dess uppgift är klar, men ett objekt (en klass definierar ett objekt) stannar vid liv ända tills den förstörs.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>I Python, så kan varje klass eller funktion ha en beskrivningssträng. Detta är speciellt användbart i FreeCAD, därför att när du anropar den klassen i tolken, så visas beskrivningssträngen som ett verktygstips.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Python klasser kan alltid innehålla en  __init__ funktion, vilken utförs när klassen anropas för att skapa ett objekt. Så här lägger vi allt som vi vill ska hända när vårt linjeverktyg börjar.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>I en klass, så vill du vanligtvis lägga till  <i>self.</i> innan ett variabelnamn, så att den kan kommas åt lätt för alla funktioner inuti och utanför den klassen. Här kommer vi att använda self.view för att komma åt och manipulera den aktiva 3D vyn.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Här skapar vi en tom lista som kommer att innehålla 3D punkterna som sänds av getpoint funktionen.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Detta är den viktiga delen: Eftersom det egentligen är en <a class="external text" href="http://www.coin3d.org/" rel="nofollow">coin3D</a> scen, så använder FreeCAD coin's återanropsmekanism, som tillåter en funktion att anropas varje gång en viss scenhändelse inträffar. I vårt fall, så skapar vi ett återanrop för <a class="external text" href="http://doc.coin3d.org/Coin/group__events.html" rel="nofollow">SoMouseButtonEvent</a> händelser, och vi binder den till getpoint funktionen. Nu, varje gång som en musknapp trycks ned eller släpps, så kommer getpoint funktionen att utföras.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Notera att det finns ett alternativ till addEventCallbackPivy() kallat addEventCallback() vilket dispenserar bruket av pivy. Men eftersom pivy är en mycket effektiv och naturlig väg att komma åt en del av coin scenen, så är det mycket bättre att använda den så mycket du kan!
</p>
</div>
<p><a href="#top">Top</a></p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Nu definierar vi getpoint funktionen, som kommer utföras när en musknapp trycks ned i en 3D vy. Denna funktion kommer att ta emot ett argument, som vi kommer kalla event_cb. Från denna händelses återanrop kan vi komma åt händelseobjektet, vilket innehåller flera informationsbitar (läge info <a href="Code_snippets.html#Observing_mouse_events_in_the_3D_viewer_via_Python/sv" title="Code snippets">här</a>).
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Getpoint funktionen kommer att anropas när en musknapp trycks ned eller släpps. Men vi vill bara välja en 3D punkt när den trycks ned (annars skulle vi få två 3D punkter mycket nära varann). Så vi måste kontrollera det här.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Här får vi musmarkörens skärmkoordinater
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Denna funktion ger oss en FreeCAD vektor (x,y,z) som innehåller den 3D punkt som ligger på fokalplanet, precis under vår musmarkör. om du är i kameravy, tänk dig en stråle som kommer från kameran, och passerar genom musmarkören, och träffar fokalplanet. Där är vår 3D punkt. On vi är i ortogonal vy, så är strålen parallell med vyriktningen.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Vi lägger till vår nya punkt till stacken
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</pre></div>
<p>Har vi tillräckligt med punkter? Om ja, låt oss då rita linjen!
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Här använder vi funktionen Line() från <a href="Part_Workbench.html" title="Part Workbench/sv">Del Modulen</a> som skapar en linje från två FreeCAD vektorer. Allt som vi skapar och ändrar inuti Del modulen, stannar i Del modulen. Så, tills nu, så har vi skapat en Linje Del. Den är inte bunden till något objekt i vårt aktiva dokument, så inget syns på skärmen.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>FreeCAD dokumentet kan bara acceptera former från Del modulen. Former är Del modulens mest allmäna typ. Så vi behöver konvertera vår linje till en form innan vi lägger till den till dokumentet.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Del modulen har en mycket smidig show() funktion som skapar ett nytt objekt i dokumentet och binder en form till den. Vi skulle också kunna ha skapat ett nytt objekt i dokumentet först, och sedan ha bundit formen till den manuellt.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Eftersom vi är klara med vår linje, låt oss ta bort vår återanropsmekanism, som använder värdefulla CPU cykler.
</p>
</div>
<p><a href="#top">Top</a></p>
<p><span id="Testing_the_script"></span>
</p>
<div class="mw-translate-fuzzy">
<h2><span id="Testa_.26_anv.C3.A4nda_skriptet"></span><span class="mw-headline" id="Testa_&amp;_använda_skriptet">Testa &amp; använda skriptet</span></h2>
<p>Låt oss nu spara vårt skript på någon plats där FreeCAD's python tolk kommer att hitta den. När moduler importerass, så kommer tolken att leta på följande platser: python's installationssökväg, FreeCAD bin katalogen, och alla FreeCAD modulkataloger. Så, den bästa lösningen är att skapa en ny katalog i en av FreeCAD's <a href="Installing_more_workbenches.html" title="Installing more workbenches/sv">Mod kataloger</a>, och spara vårt skript i den. Låt oss till exempel skapa en "MinaSkript" katalog, och spara vårt skript som  "ovning.py".
</p>
</div>
<p>Now let's save our script in a folder where the FreeCAD Python interpreter can find it. When importing modules, the interpreter will look in the following places: the Python installation paths, the FreeCAD <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">bin</span> folder, and all FreeCAD <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">Mod</span> (module) folders. So the best solution is to create a new folder in one of the <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">Mod</span> folders. Let's create a <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> folder there and save our script in it as <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">exercise.py</span>.
</p>
<div class="mw-translate-fuzzy">
<p>Nu är allt klart, låt oss starta FreeCAD, skapa ett nytt dokument, och i pythontolken skriva:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">exercise</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Om inga felmeddelanden kommer fram, så innebär det att vårt övningsskript har laddats. Vi kan nu kontrollera dess innehåll med :
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">exercise</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Kommandot dir() är ett inbyggt python kommando som listar modulens innehåll. Vi kan se att vår line() klass är där, som väntar på oss. Låt oss nu testa den:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="s1">'line'</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">exercise</span><span class="p">)</span>
</pre></div>
<p>Now let's test it:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">exercise</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Klicka sedan på två olika ställen i 3D vyn, och bingo, där är vår linje! För att göra det igen, skriv bara ovning.line() igen, och igen, och igen... Känns det bra?
</p>
</div>
<p><a href="#top">Top</a></p>
<p><span id="Registering_the_script"></span>
</p>
<div class="mw-translate-fuzzy">
<h2><span id="Registrera_skriptet_i_FreeCAD.27s_gr.C3.A4nssnitt"></span><span class="mw-headline" id="Registrera_skriptet_i_FreeCAD's_gränssnitt">Registrera skriptet i FreeCAD's gränssnitt</span></h2>
<p>För att vårt nya linjeverktyg ska bli ännu häftigare, så borde det ha en knapp i gränssnittet, så vi inte behöver skriva allt det varje gång. Den lättaste vägen är att omvandla vår nya MinaSkript katalog till en full FreeCAD arbetsbänk. Det är lätt, allt som behövs är att lägga in en fil som kallas <b>InitGui.py</b> inuti din MinaSkript katalog. InitGui.py kommer att innehålla instruktioner för att skapa en ny arbetsbänk, och addera vårt nya verktyg till den. Förutom det så behöver vi ändra vår övningskod lite, så att line() verktyget igenkänns som ett officiellt FreeCAD kommando. Låt oss starta genom att göra en InitGui.py fil, och skriva följande kod i den:
</p>
</div>
<p>For our new line tool to be really useful, and to avoid having to type all that stuff, it should have a button in the interface. One way to do this is to transform our new <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> folder into a full FreeCAD workbench. This is easy, all that is needed is to put a file called <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> inside the <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> folder. <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> will contain the instructions to create a new workbench, and add our new tool to it. Besides that we will also need to change our exercise code a bit, so the <code>line()</code> tool is recognized as an official FreeCAD command. Let's start by creating an <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> file, and writing the following code in it:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">MyWorkbench</span> <span class="p">(</span><span class="n">Workbench</span><span class="p">):</span>

    <span class="n">MenuText</span> <span class="o">=</span> <span class="s2">"MyScripts"</span>

    <span class="k">def</span> <span class="nf">Initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">exercise</span>
        <span class="n">commandslist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appendToolbar</span><span class="p">(</span><span class="s2">"My Scripts"</span><span class="p">,</span> <span class="n">commandslist</span><span class="p">)</span>

<span class="n">Gui</span><span class="o">.</span><span class="n">addWorkbench</span><span class="p">(</span><span class="n">MyWorkbench</span><span class="p">())</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Jag tror att du redan nu förstår det ovanstående skriptet: Vi skapar en ny klass som vi kallar MinArbetsbänk, vi ger den en titel (MenuText), och vi definierar en Initialize() funktion som kommer att utföras när arbetsbänken laddas till FreeCAD. I den funktionen så laddar vi innehållet i vår övningsfil, och lägger till de FreeCAD kommandon som hittas i det i en kommandolista. Sedan gör vi en verktygslåda som kallas "Mina Skript" och vi tilldelar vår kommandolista till den. För närvarande har vi förstås endast ett verktyg, så vår kommandolista innehåller endast ett element. Sedan, när vår arbetsbänk är klar, så lägger vi till den till huvudgränssnittet.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Men det kommer fortfarande inte att fungera, därför att ett FreeCAD kommando måste formatteras på ett visst sätt för att fungera. så vi behöver ändra vårt line() verktyg lite. Vår nya ovning.py skript kommer nu att se ut så här:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCADGui</span><span class="o">,</span> <span class="nn">Part</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">line</span><span class="p">:</span>

    <span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>

    <span class="k">def</span> <span class="nf">Activated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event_cb</span><span class="o">.</span><span class="n">getEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
                <span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetResources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">'Pixmap'</span><span class="p">:</span> <span class="s1">'path_to_an_icon/line_icon.png'</span><span class="p">,</span> <span class="s1">'MenuText'</span><span class="p">:</span> <span class="s1">'Line'</span><span class="p">,</span> <span class="s1">'ToolTip'</span><span class="p">:</span> <span class="s1">'Creates a line by clicking 2 points on the screen'</span><span class="p">}</span>

<span class="n">FreeCADGui</span><span class="o">.</span><span class="n">addCommand</span><span class="p">(</span><span class="s1">'line'</span><span class="p">,</span> <span class="n">line</span><span class="p">())</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Vad vi gjorde här var att omvandla vår __init__() funktion till en Activated() funktion, därför att när FreeCAD kommandon körs, så utför de automatiskt Activated() funktionen. Vi lade också till en GetResources() funktion, som informerar FreeCAD var den kan hitta en ikon för verktyget, och namnet och verktygstipset för vårt verktyg. en jpg, png eller svg bild kommer att fungera som en ikon, den kan vara av valfri storlek, men det är bäst att använda en storlek osm är nära den slutliga, som 16x16, 24x24 eller 32x32.
</p><p>Sedan lägger vi till line() klassen som ett officiellt FreeCAD kommando med addCommand() metoden.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Klart, nu behöver vi bara starta om FreeCAD och vi kommer att ha en ny snygg arbetsbänk med vårt splitternya verktyg!
</p>
</div>
<p><a href="#top">Top</a></p>
<p><span id="So_you_want_more?"></span>
</p>
<h2><span id="S.C3.A5_du_vill_ha_mer.3F"></span><span class="mw-headline" id="Så_du_vill_ha_mer?">Så du vill ha mer?</span></h2>
<div class="mw-translate-fuzzy">
<p>Om du gillade denna övningen, varför inte försöka förbättra detta lilla verktyg? Det finns många saker som kan göras, som till exempel:
</p>
<ul><li>Lägga till feedback för användaren: nu är det ett mycket 'naket' verktyg, så användaren kan bli lite osäker när det används. Så vi skulle kunna lägga till lite feedback, tala om vad som ska göras. Du skulle till exempel kunna mata ur meddelanden till FreeCAD konsolen. Ta en titt i FreeCAD.Console modulen</li>
<li>Lägga till en möjlighet att skriva in 3D punkterna manuellt. Titta på python input() funktionen, till exempel</li>
<li>Lägga till möjligheten att lägga till mer än 2 punkter</li>
<li>Lägga till händelser för andra saker: Nu kontrollerar vi endast musknappshändelser, men om vi också kunde göra något när musen förflyttas, som att visa koordinater?</li>
<li>Ge ett namn till det skapade objektet</li></ul>
<p>Tveka inte att skriva dina frågor eller ideer på <a class="external text" href="http://forum.freecadweb.org/" rel="nofollow">forum</a>!
</p>
</div>
<p>Don't hesitate to ask questions or share ideas on the <a class="external text" href="https://forum.freecadweb.org/" rel="nofollow">forum</a>!
</p>
<p><a href="#top">Top</a></p>
<div class="NavFrame" style="margin: 0px; text-align: center; border-collapse: collapse; font-size: 100%; border-top-style: double; border-top-style: 1px; clear:both;">
<div class="NavHead mw-collapsible mw-collapsed" style="margin: 1px; font-weight: normal; background-color: #fefefe;"><span typeof="mw:File"><a class="mw-file-description" href="../File/Power_user_hub.png"><img decoding="async" height="24" src="../File/Power_user_hub.png" srcset="/images/thumb/8/8f/Power_user_hub.png/36px-Power_user_hub.png 1.5x, /images/thumb/8/8f/Power_user_hub.png/48px-Power_user_hub.png 2x" width="24"/></a></span> <a href="Power_users_hub.html" title="Power users hub/sv">Power user documentation</a>
<div class="NavContent mw-collapsible-content" style="margin: 10px; border: 1px solid #aaaaaa; text-align: left; border-collapse: collapse; font-weight: normal; font-size: 100%; clear:both; margin-top: 1px; background-color: #fefefe;">
<ul><li><b>FreeCAD scripting:</b> <a class="new" href="index.php?title=Python_sv&amp;action=edit&amp;redlink=1.html" title="Python/sv (page does not exist)">Python</a>, <a href="Introduction_to_Python.html" title="Introduction to Python/sv">Introduction to Python</a>, <a class="new" href="index.php?title=Python_scripting_tutorial_sv&amp;action=edit&amp;redlink=1.html" title="Python scripting tutorial/sv (page does not exist)">Python scripting tutorial</a>, <a href="FreeCAD_Scripting_Basics.html" title="FreeCAD Scripting Basics/sv">FreeCAD Scripting Basics</a></li></ul>
<hr/>
<ul><li><b>Modules:</b> <a class="new" href="index.php?title=Builtin_modules_sv&amp;action=edit&amp;redlink=1.html" title="Builtin modules/sv (page does not exist)">Builtin modules</a>, <a href="Units.html" title="Units/sv">Units</a>, <a class="new" href="index.php?title=Quantity_sv&amp;action=edit&amp;redlink=1.html" title="Quantity/sv (page does not exist)">Quantity</a></li>
<li><b>Workbenches:</b> <a class="new" href="index.php?title=Workbench_creation_sv&amp;action=edit&amp;redlink=1.html" title="Workbench creation/sv (page does not exist)">Workbench creation</a>, <a href="Gui_Command.html" title="Gui Command/sv">Gui Commands</a>, <a class="new" href="index.php?title=Command_sv&amp;action=edit&amp;redlink=1.html" title="Command/sv (page does not exist)">Commands</a>, <a href="Installing_more_workbenches.html" title="Installing more workbenches/sv">Installing more workbenches</a></li>
<li><b>Meshes and Parts:</b> <a href="Mesh_Scripting.html" title="Mesh Scripting/sv">Mesh Scripting</a>, <a href="Topological_data_scripting.html" title="Topological data scripting/sv">Topological data scripting</a>, <a href="Mesh_to_Part.html" title="Mesh to Part/sv">Mesh to Part</a>, <a href="PythonOCC.html" title="PythonOCC/sv">PythonOCC</a></li></ul>
<hr/>
<ul><li><b>Parametric objects:</b> <a href="Scripted_objects.html" title="Scripted objects/sv">Scripted objects</a>, <a class="new" href="index.php?title=Viewprovider_sv&amp;action=edit&amp;redlink=1.html" title="Viewprovider/sv (page does not exist)">Viewproviders</a> <small>(<a class="new" href="index.php?title=Custom_icon_in_tree_view_sv&amp;action=edit&amp;redlink=1.html" title="Custom icon in tree view/sv (page does not exist)">Custom icon in tree view</a>)</small></li>
<li><b>Scenegraph:</b> <a href="Scenegraph.html" title="Scenegraph/sv">Coin (Inventor) scenegraph</a>, <a href="Pivy.html" title="Pivy/sv">Pivy</a></li>
<li><b>Graphical interface:</b> <a class="new" href="index.php?title=Interface_creation_sv&amp;action=edit&amp;redlink=1.html" title="Interface creation/sv (page does not exist)">Interface creation</a>, <a href="Dialog_creation.html" title="Dialog creation/sv">Interface creation completely in Python</a> <small>(<a class="new" href="index.php?title=Dialog_creation_with_various_widgets_sv&amp;action=edit&amp;redlink=1.html" title="Dialog creation with various widgets/sv (page does not exist)">1</a>, <a class="new" href="index.php?title=Dialog_creation_reading_and_writing_files_sv&amp;action=edit&amp;redlink=1.html" title="Dialog creation reading and writing files/sv (page does not exist)">2</a>, <a class="new" href="index.php?title=Dialog_creation_setting_colors_sv&amp;action=edit&amp;redlink=1.html" title="Dialog creation setting colors/sv (page does not exist)">3</a>, <a class="new" href="index.php?title=Dialog_creation_image_and_animated_GIF_sv&amp;action=edit&amp;redlink=1.html" title="Dialog creation image and animated GIF/sv (page does not exist)">4</a>, <a class="new" href="index.php?title=PySide_usage_snippets_sv&amp;action=edit&amp;redlink=1.html" title="PySide usage snippets/sv (page does not exist)">5</a>)</small>, <a href="PySide.html" title="PySide/sv">PySide</a>, PySide examples <a class="new" href="index.php?title=PySide_Beginner_Examples_sv&amp;action=edit&amp;redlink=1.html" title="PySide Beginner Examples/sv (page does not exist)">beginner</a>, <a class="new" href="index.php?title=PySide_Intermediate_Examples_sv&amp;action=edit&amp;redlink=1.html" title="PySide Intermediate Examples/sv (page does not exist)">intermediate</a>, <a class="new" href="index.php?title=PySide_Advanced_Examples_sv&amp;action=edit&amp;redlink=1.html" title="PySide Advanced Examples/sv (page does not exist)">advanced</a></li>
<li><b>Macros:</b> <a href="Macros.html" title="Macros/sv">Macros</a>, <a href="How_to_install_macros.html" title="How to install macros/sv">How to install macros</a></li>
<li><b>Embedding:</b> <a href="Embedding_FreeCAD.html" title="Embedding FreeCAD/sv">Embedding FreeCAD</a>, <a href="Embedding_FreeCADGui.html" title="Embedding FreeCADGui/sv">Embedding FreeCADGui</a></li></ul>
<hr/>
<ul><li><b>Other:</b> <a class="new" href="index.php?title=Expressions_sv&amp;action=edit&amp;redlink=1.html" title="Expressions/sv (page does not exist)">Expressions</a>, <a href="Code_snippets.html" title="Code snippets/sv">Code snippets</a>, <a class="mw-selflink selflink">Line drawing function</a>, <a href="FreeCAD_vector_math_library.html" title="FreeCAD vector math library/sv">FreeCAD vector math library</a> <small>(deprecated)</small></li></ul>
<hr/>
<ul><li><b>Hubs:</b> <a href="User_hub.html" title="User hub/sv">User hub</a>, <a href="Power_users_hub.html" title="Power users hub/sv">Power users hub</a>, <a href="Developer_hub.html" title="Developer hub/sv">Developer hub</a></li></ul></div>
</div></div>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20241129213315
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.131 seconds
Real time usage: 1.426 seconds
Preprocessor visited node count: 554/1000000
Post‐expand include size: 9298/2097152 bytes
Template argument size: 5209/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 24/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 21619/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00% 1285.534      1 -total
 99.17% 1274.823     24 Template:Code
  0.28%    3.620      1 Template:Powerdocnavi/sv
  0.10%    1.255      1 Template:Navigation_menu_2
  0.07%    0.907     10 Template:FileName
  0.06%    0.812      1 Template:Incode
  0.06%    0.807      1 Template:TOCright
  0.06%    0.739      6 Template:Top
  0.04%    0.534      1 Template:Clear
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:15846-0!canonical and timestamp 20241129213313 and revision id 1385055. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
