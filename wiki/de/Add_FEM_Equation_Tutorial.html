<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Add FEM Equation Tutorial/de</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="de">Deutsch</span></li>
<li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_FEM_Equation_Tutorial.html" lang="en" title="Add FEM Equation Tutorial (100% translated)">English</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_FEM_Equation_Tutorial.html" lang="fr" title="FEM Tutoriel pour ajouter des équations FEM (100% translated)">français</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_FEM_Equation_Tutorial.html" lang="it" title="Tutorial Aggiungere equazione FEM (100% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_FEM_Equation_Tutorial.html" lang="pl" title="Poradnik: Dodawanie równań w środowisku MES (100% translated)">polski</a></li>
<li><a class="mw-pt-progress mw-pt-progress--med" dir="ltr" href="Add_FEM_Equation_Tutorial.html" lang="ro" title="Adaugă Ecuația Analiza Elementului Finit Tutorial (54% translated)">română</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Add_FEM_Equation_Tutorial.html" lang="ru" title="Руководство по добавлению уравнений в верстак FEM (3% translated)">русский</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="width: 230px; float: right; margin-left: 1em">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;"><span typeof="mw:File"><span><img decoding="async" height="32" src="../File/Freecad.svg" width="32"/></span></span> Tutorium
</td></tr>
<tr>
<th class="ctOdd">Thema
</th></tr>
<tr>
<td class="ctEven">FEM Gleichung hinzufügen
</td></tr>
<tr>
<th class="ctOdd">Niveau
</th></tr>
<tr>
<td class="ctEven">Fortgeschritten
</td></tr>
<tr>
<th class="ctOdd">Zeit zum Abschluss
</th></tr>
<tr>
<td class="ctEven">1 Tag
</td></tr>
<tr>
<th class="ctOdd">Autoren
</th></tr>
<tr>
<td class="ctEven"><a class="new" href="index.php?title=User;JohnWang&amp;action=edit&amp;redlink=1.html" title="User:JohnWang (page does not exist)">JohnWang</a>
</td></tr>
<tr>
<th class="ctOdd">FreeCAD-Version
</th></tr>
<tr>
<td class="ctEven">0.19
</td></tr>
<tr>
<th class="ctOdd">Beispieldateien
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Siehe auch
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Einleitung"><span class="tocnumber">1</span> <span class="toctext">Einleitung</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Neuer_Gleichungstyp"><span class="tocnumber">2</span> <span class="toctext">Neuer Gleichungstyp</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Neues_Elmers_Gleichungs_Objekt"><span class="tocnumber">3</span> <span class="toctext">Neues Elmers Gleichungs Objekt</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Schlüsselwörter"><span class="tocnumber">3.1</span> <span class="toctext">Schlüsselwörter</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Dateien_bearbeiten"><span class="tocnumber">3.2</span> <span class="toctext">Dateien bearbeiten</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Löser_Objekt_erweitern"><span class="tocnumber">4</span> <span class="toctext">Löser Objekt erweitern</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Schreiber_Objekt_erweitern"><span class="tocnumber">5</span> <span class="toctext">Schreiber Objekt erweitern</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#GUI_Werkzeug_zum_Erstellen_einer_Gleichung"><span class="tocnumber">6</span> <span class="toctext">GUI Werkzeug zum Erstellen einer Gleichung</span></a></li>
</ul>
</div>
</td></tr></tbody></table>
<p><span id="Introduction"></span>
</p>
<h2><span class="mw-headline" id="Einleitung">Einleitung</span></h2>
<p>In dieser Anleitung werden wir FreeCAD die Gleichung <b>Strömung</b> (Flow) hinzufügen und die Unterstützung für den Löser Elmer implementieren. Bitte stelle sicher, dass du <a href="Extend_FEM_Module.html" title="Extend FEM Module/de">FEM-Modul erweitern</a> gelesen und verstanden hast, bevor du diese Anleitung liest.
</p><p>Die Aufgabe kann in fünf Teile aufgeteilt werden.
</p>
<ul><li><b>Neuer Gleichungstyp</b>. Dieser Schritt muss nur durchgeführt werden, wenn die Gleichung in FreeCAD bisher nicht existiert (im Gegensatz zu einer Gleichung, die bereits in FreeCAD existiert, aber vom Ziellöser nicht unterstützt wird).</li>
<li><b>Neues Gleichungsobjekt</b>. Hinzufügen eines konkreten Dokumentobjekts, das die Elmer-spezifische Gleichung repräsentiert.</li>
<li><b>Löserobjekt erweitern</b>. Dem Elmer-Löserobjekt Unterstützung für die neue Gleichung hinzufügen.</li>
<li><b>Writer-Objekt erweitern</b>. Erweitern des Elmer-Analyseexports zur Unterstützung des neuen Gleichungstyps.</li>
<li><b>GUI-Werkzeug zum Erstellen einer Gleichung</b>. Zugriff auf die neue Gleichungsfunktion über den GUI-Arbeitsbereich.</li></ul>
<p><span id="New_equation_type"></span>
</p>
<h2><span class="mw-headline" id="Neuer_Gleichungstyp">Neuer Gleichungstyp</span></h2>
<p>In diesem Schritt werden wir die folgende Datei modifizieren:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/equationbase.py</span></li></ul>
<p>Der Gleichungstyp wird von allen Gleichungsobjekten der verschiedenen Löser gemeinsam verwendet. Jeder Typ hat einen Zeichenfolgenspezifizierer (z.B. "Heat") und einen zugeordneten Befehl, der die Gleichung dem ausgewählten Gleichungslöser hinzufügt. Dies ermöglicht eine einfachere GUI, bei der wir nur eine Schaltfläche für die Wärmegleichung haben, die für alle unterstützten Löser verwendet wird.
</p><p>Füge zuerst die neue Gleichung zum <code>equationbase.py</code>-Modul hinzu. Jede Gleichung erfordert zwei Klassen, ein Dokument-Proxy und ein Ansicht-Proxy. Diese zwei Klassen werden später als Basisklassen für die Elmer-spezifischen Gleichungsklassen benutzt. Kopiere sie einfach von einem existierenden Gleichungstyp und passe den Icon-Pfad in <code>getIcon(self)</code> des Ansicht-Proxy an.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">FlowProxy</span><span class="p">(</span><span class="n">BaseProxy</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">FlowViewProxy</span><span class="p">(</span><span class="n">BaseViewProxy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">":/icons/FEM_EquationFlow.svg"</span>
</pre></div>
<p><span id="New_Elmer's_equation_object"></span>
</p>
<h2><span class="mw-headline" id="Neues_Elmers_Gleichungs_Objekt">Neues Elmers Gleichungs Objekt</span></h2>
<p>In diesem Schritt werden wir das Dokumentobjekt implementieren. Wir müssen eine neue Datei <code>flow.py</code> hinzufügen unter:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/elmer/equations/flow.py</span></li></ul>
<p>und die folgenden Dateien ändern:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/ObjectsFem.py</span></li>
<li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/CMakeLists.txt</span></li></ul>
<p>Beginnen wir dem Hinzufügen der neuen Datei <code>flow.py</code>. Diese Datei kann aus einer bestehenden Gleichung kopiert werden.
</p><p><span id="Keywords"></span>
</p>
<h3><span id="Schl.C3.BCsselw.C3.B6rter"></span><span class="mw-headline" id="Schlüsselwörter">Schlüsselwörter</span></h3>
<ul><li>Falls die neue Gleichung nur Schlüsselworte für <b>lineare</b> Systeme unterstützt, kopiere das <code>femsolver/elmer/equations/elasticity.py</code>-Modul.</li>
<li>Falls die neue Gleichung Schlüsselworte für <b>lineare</b> und <b>nicht-lineare</b> Systeme unterstützt, kopiere das <code>femsolver/elmer/equations/heat.py</code>-Modul.</li></ul>
<p>Die Strömungsgleichung ist eine potenziell nicht-lineare Gleichung. Das bedeutet, dass unsere Arbeit auf <code>heat.py</code> basieren wird.
</p><p><span id="Editing_files"></span>
</p>
<h3><span class="mw-headline" id="Dateien_bearbeiten">Dateien bearbeiten</span></h3>
<p>Nach dem Kopieren von <code>heat.py</code> nach <code>flow.py</code> passe letztere Datei an folgenden Stellen an:
</p>
<ul><li>das Namensargument der <code>create</code>-Modulfunktion,</li>
<li>die Basisklassen der <code>Proxy</code>-Klasse,</li>
<li>das <code>Type</code>-Attribut der <code>Proxy</code>-Klasse,</li>
<li>die <code>ViewProxy</code>-Klassen.</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"'''Flow'''"</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">femutils</span><span class="o">.</span><span class="n">createObject</span><span class="p">(</span>
        <span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Proxy</span><span class="p">,</span> <span class="n">ViewProxy</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Proxy</span><span class="p">(</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">Proxy</span><span class="p">,</span> <span class="n">equationbase</span><span class="o">.</span><span class="s1">'''Flow'''</span><span class="n">Proxy</span><span class="p">):</span>

    <span class="n">Type</span> <span class="o">=</span> <span class="s2">"Fem::EquationElmer'''Flow'''"</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Proxy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">class</span> <span class="nc">ViewProxy</span><span class="p">(</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">ViewProxy</span><span class="p">,</span> <span class="n">equationbase</span><span class="o">.</span><span class="s1">'''Flow'''</span><span class="n">ViewProxy</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Dann musst du die über die <code>obj.addProperty(..)</code>-Funktion hinzugefügten Eigenschaften auf die von der Gleichung benötigten anpassen.
</p><p>Zum Zeitpunkt des Schreibens dieses Tutoriums hat die Elmer-Strömungsgleichung keine besonderen Eigenschaften. Siehe Elmer-Elastizitätsgleichung für ein Beispiel mit Eigenschaften.
</p><p>Schließlich muss man eine <b>makeEquationFlow</b>-Definition in <code>src/Mod/Fem/ObjectsFem.py</code> durch Duplizieren eines verfügbaren Eintrags registrieren.
</p><p>FreeCAD benutzt <b>make</b> zur Erstellung des Programms. Deshalb müssen wir die neue Moduldatei (<code>flow.py</code>) in <code>src/Mod/Fem/CMakeLists.txt</code> registrieren, wie in <a class="external text" href="https://www.freecadweb.org/wiki/Extend_FEM_Module" rel="nofollow">FEM Modul erweitern</a> beschriebenen. Die passenden Listen lassen sich leicht finden, indem man nach vorhandenen Gleichungsmoduldateien von Elmer sucht.
</p><p><span id="Extend_Solver_Object"></span>
</p>
<h2><span id="L.C3.B6ser_Objekt_erweitern"></span><span class="mw-headline" id="Löser_Objekt_erweitern">Löser Objekt erweitern</span></h2>
<p>In diesem Schritt werden wir die folgenden Dateien modifizieren:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/elmer/solver.py</span></li></ul>
<p>Gerade jetzt haben wir FreeCAD darauf aufmerksam gemacht, dass es einen neuen Gleichungstyp gibt, und sogar einen Befehl hinzugefügt, der diese Gleichung dem ausgewählten Löserobjekt hinzufügt. Wir haben auch ein konkretes Gleichungsobjekt für Elmer implementiert. Was jetzt noch zu tun bleibt, ist die Verbindung zwischen Elmer und der Strömungsgleichung herzustellen. Dies muss direkt im Elmer-Lösungsobjekt erfolgen.
</p><p>Registriere das Modul, in dem wir gerade unser neues Gleichungsobjekt (<code>flow.py</code>) implementiert haben, mit dem Gleichungsspezifizierer aus Schritt 1 ("Flow") in der  <code>_EQUATIONS</code> Liste in <code>elmer/solver.py</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">.equations</span> <span class="kn">import</span> <span class="n">electrostatic</span>
<span class="o">+</span><span class="kn">from</span> <span class="nn">.equations</span> <span class="kn">import</span> <span class="n">flow</span>

<span class="o">...</span>

<span class="n">_EQUATIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Heat"</span><span class="p">:</span> <span class="n">heat</span><span class="p">,</span>
    <span class="s2">"Elasticity"</span><span class="p">:</span> <span class="n">elasticity</span><span class="p">,</span>
<span class="o">+</span>    <span class="s2">"Flow"</span><span class="p">:</span> <span class="n">flow</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
<p><span id="Extend_writer_object"></span>
</p>
<h2><span class="mw-headline" id="Schreiber_Objekt_erweitern">Schreiber Objekt erweitern</span></h2>
<p>In diesem Schritt werden wir die folgende Datei modifizieren:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/elmer/writer.py</span></li></ul>
<p>Diese Datei enthält die Klasse <code>Writer</code>, die die Analyse in das Elmer-SIF Format exportiert.
</p><p>Für jede unterstützte Gleichung gibt es zwei Methoden für den Export der jeweiligen Gleichung. Kopiere einfach alle von einer bestehenden Gleichung und passe sie an deine Bedürfnisse an.
</p>
<ul><li><code>_getFlowSolver</code></li>
<li><code>_handleFlow</code></li></ul>
<p>Du musst die <code>_handleFlow</code>-Methode in der <code>Writer</code>-Klasse registrieren:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">Writer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="o">...</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handleFlow</span><span class="p">()</span>

<span class="o">...</span>
</pre></div>
<p><code>_handleFlow</code> kann eine Reihe weiterer detaillierter Methoden kontrollieren. Unsere Fließ-Gleichung benutzt die folgenden detaillierten Methoden:
</p>
<ul><li><code>_handleFlowConstants</code></li>
<li><code>_handleFlowMaterial</code></li>
<li><code>_handleFlowInitialVelocity</code></li>
<li><code>_handleFlowBndConditions</code></li>
<li><code>_handleFlowEquation</code></li></ul>
<p>Nun haben wir den Funktionsteil der neuen Gleichung beendet. Nun werden wir die neue Gleichung an die GUI anbinden.
</p><p><span id="Gui_tool_to_create_an_equation"></span>
</p>
<h2><span class="mw-headline" id="GUI_Werkzeug_zum_Erstellen_einer_Gleichung">GUI Werkzeug zum Erstellen einer Gleichung</span></h2>
<p>Wir haben gerade eine neue Gleichungsklasse erstellt. Um sie über die FEM-GUI anzusprechen, müssen wir eine Schaltfläche erstellen und sie mit der neuen Gleichungsklasse verbinden. Hier ist ein Tutorium:
<a href="Add_Button_to_FEM_Toolbar_Tutorial.html" title="Add Button to FEM Toolbar Tutorial/de">Tutorium Schaltfläche zur FEM Werkzeugleiste hinzufügen</a>.
</p>
<!-- 
NewPP limit report
Cached time: 20241129212124
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.077 seconds
Real time usage: 0.816 seconds
Preprocessor visited node count: 347/1000000
Post‐expand include size: 2760/2097152 bytes
Template argument size: 1490/2097152 bytes
Highest expansion depth: 4/100
Expensive parser function count: 4/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 6199/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  715.342      1 -total
 98.76%  706.472      4 Template:Code
  0.37%    2.641      1 Template:TutorialInfo/de
  0.30%    2.140     32 Template:Incode
  0.25%    1.814      6 Template:FileName
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:193870-0!canonical and timestamp 20241129212123 and revision id 1263275. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
