<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro Build Utility/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_Build_Utility.html" lang="en" title="Macro Build Utility (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_Build_Utility.html" lang="it" title="Macro Build Utility (100% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_Build_Utility.html" lang="pl" title="Makrodefinicja: Narzędzie do budowania (4% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/Macro_Build_Utility.png"><img decoding="async" height="32" src="../File/Macro_Build_Utility.png" srcset="/images/thumb/8/87/Macro_Build_Utility.png/48px-Macro_Build_Utility.png 1.5x, /images/8/87/Macro_Build_Utility.png 2x" width="32"/></a></span><span> </span>
Macro Build Utility
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cette macro fournit un utilitaire de compilation permettant d'assembler plusieurs fichiers projets en un seul.<br/><br/>Version macro : 1.0<br/>Date dernière modification : 2015-01-21<br/>Version FreeCAD : Toutes<br/>Téléchargement : <a class="external text" href="https://www.freecadweb.org/wiki/images/8/87/Macro_Build_Utility.png" rel="nofollow">ToolBar Icon</a><br/>Auteur: Piffpoof<br/>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="User;Piffpoof.html" title="User:Piffpoof">Piffpoof</a>
</td></tr>
<tr>
<th class="ctOdd">Téléchargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://www.freecadweb.org/wiki/images/8/87/Macro_Build_Utility.png" rel="nofollow">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br/><a href="How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars/fr">Comment créer une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Dernière modification
</th></tr>
<tr>
<td class="ctEven macro-date">2015-01-21
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">Toutes
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Usage"><span class="tocnumber">3</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Interface_utilisateur"><span class="tocnumber">4</span> <span class="toctext">Interface utilisateur</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Options"><span class="tocnumber">5</span> <span class="toctext">Options</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Remarques"><span class="tocnumber">6</span> <span class="toctext">Remarques</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Liens"><span class="tocnumber">7</span> <span class="toctext">Liens</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Script"><span class="tocnumber">8</span> <span class="toctext">Script</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Exemple"><span class="tocnumber">9</span> <span class="toctext">Exemple</span></a></li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro est destinée à des projets volumineux, impliquant des centaines d'objets. Son utilisation sur un petit projet avec un fichier unique serait inutile. Toutefois, dans le cas d’un projet volumineux comportant de nombreux objets et de nombreux fichiers à fusionner, cela fera gagner du temps, et évitera à l’utilisateur d’être impliqué dans des actions répétitives et supprimera les erreurs humaines.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>Tout le code pour buildUtility.FCMacro est dans une macro. L'installation consiste donc à copier le code dans le répertoire Macro approprié et à appeler l'utilitaire de génération à partir du menu Macro, de la console Python ou d'un bouton de la barre d'outils (méthode recommandée).
</p>
<ul><li>voir <a href="How_to_install_macros.html" title="How to install macros/fr">Comment installer des macros</a> pour des informations sur la façon d'installer ce code de macro</li>
<li>voir <a href="Customize_Toolbars.html" title="Customize Toolbars/fr">Personnaliser les barres d'outils</a> pour plus d'informations sur l'installation en tant que bouton dans une barre d'outils</li></ul>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>L'utilitaire de construction fonctionne sur les mêmes principes que les fichiers de construction utilisés pour assembler des systèmes logiciels volumineux (comme FreeCAD). Un éditeur de texte est utilisé pour créer un fichier texte qui respecte les formats requis par l'utilitaire de génération. L'utilitaire de construction lit ensuite chaque ligne du fichier texte et exécute les actions spécifiées par ce fichier texte.
</p><p>La macro demande à l'utilisateur un "fichier de construction". Il analyse ensuite le fichier de construction, il existe 3 types de lignes:
</p>
<ul><li>lignes commençant par le caractère de commentaire "#", qui sont ignorées en tant que commentaires ou remarques</li>
<li>lignes commençant par le caractère de sous-fichier "@" qui sont ignorées <br/> <b> Remarque </b>: le caractère "@" est destiné à une amélioration future lorsque les fichiers de construction inférieurs seront gérés.</li>
<li>toutes les autres lignes pouvant être un fichier de projet ou un sous-répertoire</li></ul>
<p>L'extension de fichier pour le fichier Build Utility est ".FCBld". Ceci afin que les fichiers ne soient pas mélangés avec d'autres utilisations et applications.
</p><p>Tout fichier spécifié dans le fichier de construction est supposé avoir l'extension ".FCStd"
Si la ligne commence par un répertoire, le fichier de projet est lu à partir de ce sous-dossier. Sinon, on suppose que la ligne spécifie un fichier de projet. Les répertoires au sein des répertoires sont pris en charge, ce qui permet d'imbriquer des profondeurs arbitraires. Le format de spécification de fichier est le style "Unix" avec différents niveaux séparés par la barre oblique "/".
</p><p>Tout fichier manquant est imprimé sur la vue Rapport. Tout répertoire manquant est imprimé sur la vue Rapport.
</p><p>Un nouveau document est créé et chaque projet est un "Projet fusionné" dans ce nouveau document vide.
Une fois terminé le document n'est pas enregistré, libre à l'utilisateur de le sauvegarder s'il le souhaite.
Si le fichier n'existe pas, le nom du fichier est Imprimé dans la vue Rapport.
</p>
<h2><span class="mw-headline" id="Interface_utilisateur">Interface utilisateur</span></h2>
<p>Il n'y a pas vraiment d'interface graphique pour cette macro. La macro lit un fichier texte qui a été préparé avec un éditeur de texte et génère un modèle dans un document de sortie. En dehors du fait de cliquer sur le bouton de la barre d’outils pour lancer le processus, il n’y a pas d’interaction de la part de l’utilisateur.
</p>
<h2><span class="mw-headline" id="Options">Options</span></h2>
<p>Il n'y a pas d'interface graphique, donc il n'y a pas d'options. Les seules alternatives qui existent consistent à utiliser les 3 types de lignes du fichier texte, comme décrit ci-dessus.
</p>
<h2><span class="mw-headline" id="Remarques">Remarques</span></h2>
<p>Pour réitérer ce qui a été dit au début, cette macro n’est pas utile sur un fichier unique. Mais pour les personnes qui modélisent un avion, une locomotive, un navire, un bâtiment, une installation physique ou un circuit complexe, il existe un avantage et un avantage définitifs. En choisissant l'extension de fichier ".FCBld", on espère pouvoir définir une norme de tri pour les fichiers de construction dans FreeCAD. En réservant le caractère de préfixe "@" dans la définition du fichier de commande, on espère pouvoir en tenir compte pour une utilisation future et (si nécessaire) pour la croissance.
</p>
<h2><span class="mw-headline" id="Liens">Liens</span></h2>
<p>none (so far)
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/Macro_Build_Utility.png"><img decoding="async" height="64" src="../File/Macro_Build_Utility.png" width="64"/></a></span>
</p><p><b>Macro_Build_Utility.FCMacro</b>
</p>
<pre>#
#						Build Utility
#                       v 0.0 - build from files and files in sub-folders
#
#***********************************************************************************
# routine to read in a build file and merge all specified projects
"""
This function asks the user for a "build file". It then parses that build file, there
are 3 legal line types:
- lines starting with the comment character "#" which are ignored
- lines starting with the subfile character "@" which are ignored
	Note:	the "@" character is for future enhancement when sub-build files 
			will be handled
- all other lines which may be a project file or a subfolder (sub-directory)
If the line is a subfolder then the project file is read from that subfolder.
Otherwise it is assumed the line specifies a project file.
A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
"""
"""
Example file:
#this is a sample build file
#==============================
@sub-build-files - not presently inplemented
# first the top-level file
metal
# now some misc files
./black/black
./blue/blue
# file does not exist
zebra 
# folder does not exist
/bear/bear
# multiple files in one sub-folder
./engineering/green
./engineering/grey
#multiple files in hierarchical folders
./externalModules/white
./externalModules/red/red
#./externalModules/red/stackerAssembly - commented out as not currently loading
./externalModules/red/orange
./externalModules/red/level3/yellow
"""
# import statements
import FreeCAD
import os.path
from PySide import QtGui

# UI Class definitions

# Class definitions

# Function definitionss

# Constant definitions
buildTargetDocument = "build_target"
commentTag = "#"
subfileTag = "@"
lineFeed = "\n"
subfolder = "./"
carriageReturn = "\r"
fileSeparator = "/"
fcFileExtension      = ".FCStd"
fcFileExtensionUC  = ".FCSTD"
fcFileExtensionLen = -6

# code ***********************************************************************************
buildFilePathName=QtGui.QFileDialog.getOpenFileName()[0]
if len(buildFilePathName) &gt; 0:
	# set up a new empty "build_target" document
	FreeCAD.newDocument(buildTargetDocument)
	FreeCAD.setActiveDocument(buildTargetDocument)
	FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
	guiDoc=FreeCADGui.ActiveDocument
	#
	lastFileSeparator = buildFilePathName.rindex(fileSeparator)
	buildFilePath = buildFilePathName[: lastFileSeparator]
	buildFileName = buildFilePathName[lastFileSeparator +1:]
	#
	buildFileContents = open(buildFilePathName,"r")
	buildFileLines = buildFileContents.readlines()
	buildFileContents.close()
	#
	for line in buildFileLines:
		if line[0] == commentTag:
			# line of internal comment
			pass
		elif line[0] == subfileTag:
			# line of sub-build-file (not presently implemented)
			pass
		else:
			# a line which should specify a FreeCAD project file
			# - may be preceded by a sub-directory e.g. "./subdir309/"
			# - project file may be missing file extension
			#
			# if line break at end of file spec then remove
			if line[-1:] == lineFeed:
				line = line[:-1]
			if line[-1:] == carriageReturn:
				line = line[:-1]
			# if no FreeCAD project file extension supplied then append one
			# make an uppercase comparison in case of mixed case
			tempLine = fcFileExtension + line.upper()
			if fcFileExtensionUC != tempLine[fcFileExtensionLen:]:
				line = line + fcFileExtension
			# if there is a leading subdirectory then remove "./" from beginning
			if subfolder[0:2] == line[0:2]:
				line = line[2:]
			projectFileSpec = str(buildFilePath) + str("/") + str(line)
			if os.path.exists(projectFileSpec):
				guiDoc.mergeProject(projectFileSpec)
			else:
				FreeCAD.Console.PrintMessage('project file "' + projectFileSpec + '" not found' + "\n")

	# set view back to "build_target", it is up to user to save it (if they want)
	FreeCAD.setActiveDocument(buildTargetDocument)
	FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
	FreeCADGui.ActiveDocument=FreeCADGui.getDocument(buildTargetDocument)
	FreeCADGui.SendMsgToActiveView("ViewFit")
	FreeCADGui.activeDocument().activeView().viewAxometric()
#
#OS: Mac OS X
#Word size: 64-bit
#Version: 0.14.3703 (Git)
#Branch: releases/FreeCAD-0-14
#Hash: c6edd47334a3e6f209e493773093db2b9b4f0e40
#Python version: 2.7.5
#Qt version: 4.8.6
#Coin version: 3.1.3
#SoQt version: 1.5.0
#OCC version: 6.7.0
#
#thus ends the macro...</pre>
<p><br/>
</p>
<h2><span class="mw-headline" id="Exemple">Exemple</span></h2>
<p>Vous travaillez avec d'autres services de votre entreprise pour utiliser FreeCAD afin de générer un grand modèle de CAO pour un client externe. Pour préparer la présentation à venir, vous devez intégrer les modèles représentés dans les sous-systèmes "noir" et "bleu". Le service d'ingénierie est responsable des sous-systèmes "vert" et "gris" et vous disposez vous-même du sous-système "métal" sur votre ordinateur. Le client utilise également FreeCAD et votre conception doit intégrer leurs sous-systèmes "rouge" et "jaune". Le client externe vous a dit que l’empileur n’est pas prêt à être utilisé. Vous devez donc le commenter dans votre fichier de construction.
</p><p>Il y a beaucoup de chemins de dossiers à taper afin que vous puissiez entrer les commandes dans le fichier texte de Build Utility, ce qui signifie que vous pouvez l'exécuter en un simple clic sur un bouton de la barre d'outils.
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/MacroBuildUtilityTreeDiagram.jpg"><img decoding="async" height="371" src="../File/MacroBuildUtilityTreeDiagram.jpg" srcset="/images/thumb/3/31/MacroBuildUtilityTreeDiagram.jpg/750px-MacroBuildUtilityTreeDiagram.jpg 1.5x, /images/thumb/3/31/MacroBuildUtilityTreeDiagram.jpg/1000px-MacroBuildUtilityTreeDiagram.jpg 2x" width="500"/></a></span>
</p><p>Le contenu du fichier de construction "buildFile.FCBld" présenté ci-dessous montre la structure de fichier du projet décrit ci-dessus.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">#this is the build file for the complete assembly</span>
<span class="c1">#==============================</span>
<span class="nd">@sub</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">files</span> <span class="o">-</span> <span class="ow">not</span> <span class="n">presently</span> <span class="n">implemented</span>
<span class="c1"># first the top-level file</span>
<span class="n">metal</span>
<span class="c1"># now some misc files</span>
<span class="o">./</span><span class="n">black</span><span class="o">/</span><span class="n">black</span>
<span class="o">./</span><span class="n">blue</span><span class="o">/</span><span class="n">blue</span>
<span class="c1"># file does not exist</span>
<span class="n">zebra</span> 
<span class="c1"># folder does not exist</span>
<span class="o">/</span><span class="n">bear</span><span class="o">/</span><span class="n">bear</span>
<span class="c1"># multiple files in one sub-folder</span>
<span class="o">./</span><span class="n">engineering</span><span class="o">/</span><span class="n">green</span>
<span class="o">./</span><span class="n">engineering</span><span class="o">/</span><span class="n">grey</span>
<span class="c1">#multiple files in hierarchical folders</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">white</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">red</span>
<span class="c1">#./externalModules/red/stackerAssembly - commented out as not currently loading</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">orange</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">yellow</span>
</pre></div>
<p>Un résumé du fichier et de la façon dont il est traité est:
</p>
<ul><li>les deux premières lignes sont traitées comme des commentaires et tout ce qui suit le caractère initial du signe dièse est ignoré</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">#this is the build file for the complete assembly</span>
<span class="c1">#==============================</span>
</pre></div>
<ul><li>la troisième ligne est également ignorée car son premier caractère est le caractère esperluette qui est réservé pour une utilisation future, où les fichiers de commande peuvent appeler d'autres fichiers de recommandation.</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="nd">@sub</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">files</span> <span class="o">-</span> <span class="ow">not</span> <span class="n">presently</span> <span class="n">implemented</span>
</pre></div>
<ul><li>la cinquième ligne est la première spécification de fichier, le fichier est dans le même répertoire que le fichier de construction, pas dans un sous-répertoire</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">metal</span>
</pre></div>
<ul><li>les septième et huitième lignes sont les deux spécifications de fichier où le fichier est dans un sous-répertoire, notez que le sous-répertoire est de la forme "./black/" où "noir" est le nom du répertoire, donc un fichier appelé "sheetFold.FCstd" dans le répertoire "outsourcing" apparaîtrait "./outsourcing/sheetFold"</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">./</span><span class="n">black</span><span class="o">/</span><span class="n">black</span>
<span class="o">./</span><span class="n">blue</span><span class="o">/</span><span class="n">blue</span>
</pre></div>
<ul><li>la dix-neuvième ligne montre une spécification de fichier qui existe mais qui n'est pas incluse dans cette opération de construction</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">#./externalModules/red/stackerAssembly - commented out as not currently loading</span>
</pre></div>
<ul><li>les deux dernières lignes montrent les spécifications du fichier et où le fichier se trouve dans plus d'un niveau de sous-répertoire</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">orange</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">yellow</span>
</pre></div>
<p><br/>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20241129211021
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.077 seconds
Real time usage: 0.778 seconds
Preprocessor visited node count: 191/1000000
Post‐expand include size: 2835/2097152 bytes
Template argument size: 5953/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 9/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 9643/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  704.015      1 -total
 99.02%  697.098      7 Template:Code
  0.52%    3.640      1 Template:Macro/fr
  0.14%    0.994      1 Template:Clear
  0.13%    0.925      1 Template:MacroCode
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:56435-0!canonical and timestamp 20241129211020 and revision id 692052. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
