<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro SketchUnmap/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_SketchUnmap.html" lang="en" title="Macro SketchUnmap (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_SketchUnmap.html" lang="it" title="Macro SketchUnmap (4% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_SketchUnmap.html" lang="pl" title="Makrodefinicja: SketchUnmap (4% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/SketchUnmap.svg"><img decoding="async" height="32" src="../File/SketchUnmap.svg" width="32"/></a></span><span> </span>
SketchUnmap
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cette macro réinitialise un emplacement absolu de l’esquisse et crée éventuellement un plan de référence.<br/>Cette macro a été écrite principalement pour contourner le problème de dénomination topologique qui peut casser un modèle lorsqu'une esquisse a été directement ou indirectement attachée à une face ou à tout autre élément topologique.<br/>
<p>Pour éviter les ruptures, une macro doit être appliquée lorsque le modèle est toujours correct. Elle ne peut pas "réparer" un modèle cassé. Si vous venez de casser votre modèle, annulez les dernières modifications dans une bonne situation, appliquez la macro aux esquisses instables, puis recommencez l'opération précédente.<br/><br/>Version macro : 0.6.2<br/>Date dernière modification : 2019-06-14<br/>Version FreeCAD : 0.17 et au dessus<br/>Téléchargement : <a class="external text" href="https://wiki.freecad.org/images/3/34/SketchUnmap.svg" rel="nofollow">Icône de la barre d'outils</a><br/>Auteur: OpenBrain<br/>
</p>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a class="new" href="index.php?title=User;OpenBrain&amp;action=edit&amp;redlink=1.html" title="User:OpenBrain (page does not exist)">OpenBrain</a>
</td></tr>
<tr>
<th class="ctOdd">Téléchargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://wiki.freecad.org/images/3/34/SketchUnmap.svg" rel="nofollow">Icône de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br/><a href="How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars/fr">Comment créer une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.6.2
</td></tr>
<tr>
<th class="ctOdd">Dernière modification
</th></tr>
<tr>
<td class="ctEven macro-date">2019-06-14
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17 et au dessus
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Contexte"><span class="tocnumber">1.1</span> <span class="toctext">Contexte</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Utilisation"><span class="tocnumber">1.2</span> <span class="toctext">Utilisation</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Installation"><span class="tocnumber">1.3</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Détails"><span class="tocnumber">1.4</span> <span class="toctext">Détails</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Script"><span class="tocnumber">2</span> <span class="toctext">Script</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Limitations"><span class="tocnumber">2.1</span> <span class="toctext">Limitations</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Discussion_sur_le_forum"><span class="tocnumber">2.2</span> <span class="toctext">Discussion sur le forum</span></a></li>
</ul>
</li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><span id="Context"></span>
</p>
<h3><span class="mw-headline" id="Contexte">Contexte</span></h3>
<p>Cette macro a été écrite principalement pour contourner le problème de dénomination topologique susceptible de casser un modèle lorsqu'une esquisse a été directement ou indirectement attachée à une face ou à tout autre élément topologique.
Pour éviter les ruptures, une macro doit être appliquée lorsque le modèle est toujours correct. Il ne peut pas "réparer" un modèle cassé. Si vous venez de casser votre modèle, annulez les dernières modifications dans une bonne situation, appliquez la macro aux esquisses instables, puis recommencez l'opération précédente.
</p><p><span id="Usage"></span>
</p>
<h3><span class="mw-headline" id="Utilisation">Utilisation</span></h3>
<p>Sur le plan fonctionnel, la macro supprimera le mappage actuel de l'esquisse sur laquelle elle est appliquée, puis lui appliquera un placement absolu afin de l'immuniser contre les modifications de support de mappage.
</p><p>Pour ce faire, la macro proposera essentiellement 3 options (si votre esquisse n'est pas dans un corps PartDesign, seule la première option est disponible et sera appliquée automatiquement):
</p>
<ul><li>Mode "Raw" =&gt; le placement de l'esquisse est rendu absolu dans le référentiel de corps, rien de plus</li>
<li>"Mode DP@Face" =&gt; un plan de référence est créé à l'emplacement de la face de mappage, puis l'esquisse y est attachée en respectant son décalage d'attache</li>
<li>Mode "DP@Sketch" =&gt; un lieu de référence est créé à l'emplacement de l'esquisse (y compris le décalage de la pièce jointe), puis l'esquisse est attachée à son origine</li></ul>
<p>Pour utiliser la macro, sélectionnez simplement l'esquisse cible (par exemple, dans l'arborescence), puis exécutez la macro. C'est tout !
</p>
<h3><span class="mw-headline" id="Installation">Installation</span></h3>
<p>La macro est disponible via le <a href="Std_AddonMgr.html" title="Std AddonMgr/fr">gestionnaire d'extensions</a>.
Le code est fourni sur cette page pour plus de commodité au cas où votre système n'ait pas git-python. Bien qu'elle devrait être à jour, la dernière version de la macro est toujours disponible sur <a class="external text" href="https://github.com/FreeCAD/FreeCAD-macros/blob/master/Information/SimpleProperties.FCMacro" rel="nofollow">FreeCAD-macro repository</a>
</p><p>Pour des explications plus détaillées, voir la page <a href="How_to_install_macros.html" title="How to install macros/fr"> Comment installer des macros</a>.
</p><p><span id="Details"></span>
</p>
<h3><span id="D.C3.A9tails"></span><span class="mw-headline" id="Détails">Détails</span></h3>
<p>Pour une meilleure compréhension, voici un exemple:
Supposons un simple cube dont la face supérieure (jaune) a été dessinée. Un cylindre est créé avec un cercle matelassé dont l'esquisse a été mappée (face plate) à la face préparée et décalée pour répondre aux besoins (offset de pièce jointe):
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/Unmap_ex1.png"><img decoding="async" height="361" src="../File/Unmap_ex1.png" width="936"/></a></span>
</p><p>Maintenant, pour une raison quelconque, vous devez inverser la direction de tirage du tirage (bien sûr, sans que le cylindre se déplace). Voici ce qui se passe fondamentalement:
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/Unmap_ex2.png"><img decoding="async" height="366" src="../File/Unmap_ex2.png" width="1024"/></a></span>
</p><p>L'arborescence indique une erreur, la vue 3D n'est pas mise à jour et l'esquisse du cercle flotte au milieu de nulle part ...
</p><p>Vient maintenant le travail de la macro (que vous devez exécuter avant de changer la face de référence, lorsque l'esquisse est toujours à la bonne place). Sélectionnez l'esquisse et exécutez-le. Si votre esquisse est dans un corps, une boîte de message vous demandera de choisir parmi les 3 options différentes (si votre esquisse sort d’un corps, elle appliquera automatiquement la première):
</p>
<ul><li>"Raw" mode</li>
<li>"DP@Face mode"</li>
<li>"DP@Sketch" mode</li></ul>
<p>Ce qui en terme d'image donne ce qui suit:
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/Unmap_macro.png"><img decoding="async" height="782" src="../File/Unmap_macro.png" width="669"/></a></span>
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>Icône de la barre d'outils <span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/SketchUnmap.svg"><img decoding="async" height="64" src="../File/SketchUnmap.svg" width="64"/></a></span>
</p><p><b>Macro_SketchUnmap.FCMacro</b>
</p>
<pre>#!/usr/bin/python
#####################################
# Copyright (c) openBrain 2019
# Licensed under LGPL v2
#
# This FreeCAD macro will unmap a sketch from eg. a face and make its placement absolute in the body. It proposes 3 options (forcely the first if sketch not in a body) :
# * "Raw" mode =&gt; the sketch placement is made absolute in the body referential, nothing more
# * "DP@Face mode" =&gt; a datum plane is created where the mapping face is, then the sketch is attached to it respecting its attachment offset
# * "DP@Sketch" mode =&gt; a datum place is created where the sketch is (including attachment offset), then the sketch is attached to its origin
#
# Main use of the macro is to make design more robust to topological naming issue
#
# Version history :
# *0.6.2 : add icon (metadata)
# *0.6.1 : minor changes after PR review
# *0.6 : some typo improvement + commenting for official PR
# *0.5 : beta release
#
#####################################

__Name__ = 'SketchUnmap'
__Comment__ = 'Unmap a sketch &amp; makes its placement absolute"'
__Author__ = 'openBrain'
__Version__ = '0.6.2'
__Date__ = '2019-06-14'
__License__ = 'LGPL v2'
__Web__ = 'https://www.freecadweb.org/wiki/Macro_SketchUnmap'
__Wiki__ = 'https://www.freecadweb.org/wiki/Macro_SketchUnmap'
__Icon__ = 'https://wiki.freecad.org/images/3/34/SketchUnmap.svg'
__Help__ = 'Select the sketch to unmap (eg. in the tree view) then run the macro'
__Status__ = 'Beta'
__Requires__ = 'FreeCAD &gt;= 0.17'
__Communication__ = 'https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=36078'
#    __Files__ = ''

__dbg__ = False  #True for debugging

from PySide import QtGui

def cslM(msg): #Print message in console
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintMessage(msg)

def cslW(msg): #Print warning in console
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintWarning(msg)

def cslE(msg): #Print error in console
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintError(msg)

def cslD(msg): #Print debug message in console
    if __dbg__:
        FreeCAD.Console.PrintMessage('\n')
        FreeCAD.Console.PrintMessage("Debug : " + str(msg))

_0Vec_ = FreeCAD.Vector(0, 0, 0) #Shortener for null vector
_ZVec_ = FreeCAD.Vector(0, 0, 1) #Shortener for Z axis

if __dbg__:  ##Clear report view in debug mode
    FreeCADGui.getMainWindow().findChild(QtGui.QTextEdit, "Report view").clear()

cslM("Starting SketchUnmap macro")
cslD("Checking selection")

##If selection is wrong, print error message and exit
if (len(Gui.Selection.getSelection()) != 1 or str(Gui.Selection.getSelection()[0]) != '&lt;Sketcher::SketchObject&gt;'):
    cslE("You must select a sketch that you want to unmap (and only one) ... Exiting")
else:
    cslD("Selection OK")
    App.ActiveDocument.openTransaction("SketchUnmap") #Open transaction for undo management
    sk = Gui.Selection.getSelection()[0] #Get target sketch
    skNatPl = sk.Placement #Store placement
    skNatAO = sk.AttachmentOffset #Store attachment offset
    skInBody = False
    for obj in sk.InList: ##Check if sketch is inside a Body
        if obj.TypeId == 'PartDesign::Body':
            skInBody = True
            skBody = obj
    cslD("Sketch in a body : " + str(skInBody))
    msgb = QtGui.QMessageBox() ##Prepare the message box to choose option
    msgb.setWindowTitle("Unmap Sketch : Mode selection")
    msgb.setText("""Choose which unmapping mode you want to apply :
    Raw =&gt; the sketch placement is made absolute in the body referential, nothing more
    DP@Face =&gt; a datum plane is created where the mapping face is, then the sketch is attached to it respecting its attachment offset
    DP@Sketch =&gt; a datum place is created where the sketch is (including attachment offset), then the sketch is attached to its origin
        Click 'Cancel' to cancel operation""")
    msgb.setIcon(QtGui.QMessageBox.Question)
    rbut = msgb.addButton("Raw", QtGui.QMessageBox.AcceptRole)
    fbut = msgb.addButton("DP@Face", QtGui.QMessageBox.AcceptRole)
    sbut = msgb.addButton("DP@Sketch", QtGui.QMessageBox.AcceptRole)
    cbut = msgb.addButton("Cancel", QtGui.QMessageBox.RejectRole)
    if skInBody: #If sketch in a Body
        msgb.exec_() ##Show message box and get user choice
        msgbRep = msgb.clickedButton()
    else:
        msgbRep = rbut #Else apply raw mode automatically
    if msgbRep == rbut: #If raw mode
        sk.Support = None ##Just unmap the sketch so its placement is absolute
        sk.MapMode = 'Deactivated'
    elif msgbRep == fbut: #If DP@Face mode
        newDP = skBody.newObject('PartDesign::Plane','DP' + sk.Name) #Create a datum plane
        if sk.Label != sk.Name: ##Eventually clarify its label
            newDP.Label = 'DP' + sk.Label
        newDP.Support = None ##Plane is placed absolute
        newDP.MapMode = 'Deactivated'
        newDP.Placement = skNatPl.multiply(skNatAO.inverse()) #Plane placement is set to former face one
        sk.Support = [(newDP,'')] #Sketch is mapped to plane keeping its attachment offset
    elif  msgbRep == sbut: #If DP@Sketch mode
        newDP = skBody.newObject('PartDesign::Plane','DP' + sk.Name) #Create a datum plane
        if sk.Label != sk.Name: ##Eventually clarify its label
            newDP.Label = 'DP' + sk.Label
        newDP.Support = None ##Plane is placed absolute
        newDP.MapMode = 'Deactivated'
        newDP.Placement = skNatPl #Plane placement is set to former sketch one
        sk.Support = [(newDP,'')] ##Sketch is mapped to plane resetting its attachment offset
        sk.AttachmentOffset = App.Placement(_0Vec_, App.Rotation(_ZVec_, 0))
    App.ActiveDocument.commitTransaction() #Commit transaction for undo management
    cslM("SketchUnmap Macro ended correctly")</pre>
<h3><span class="mw-headline" id="Limitations">Limitations</span></h3>
<ul><li>Ne traitez qu'un croquis à la fois</li>
<li>Travaillez uniquement sur des objets d'esquisse</li></ul>
<p><span id="Forum_discussion"></span>
</p>
<h3><span class="mw-headline" id="Discussion_sur_le_forum">Discussion sur le forum</span></h3>
<p>Pour tout commentaire (bug, demande de fonctionnalité, commentaires, ...), veuillez utiliser ce fil de discussion : <a class="external text" href="https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=36078" rel="nofollow">(FR) macro to remap sketch to different reference</a>
</p>
<!-- 
NewPP limit report
Cached time: 20241129211818
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.050 seconds
Real time usage: 0.102 seconds
Preprocessor visited node count: 111/1000000
Post‐expand include size: 2697/2097152 bytes
Template argument size: 6867/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 6572/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    6.596      1 -total
 58.26%    3.843      1 Template:MacroCode
 40.19%    2.651      1 Template:Macro/fr
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:154546-0!canonical and timestamp 20241129211818 and revision id 1346609. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
