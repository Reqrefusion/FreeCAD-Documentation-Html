<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro Section/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_Section.html" lang="en" title="Macro Section (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_Section.html" lang="hr" title="Macro Section (100% translated)">hrvatski</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_Section.html" lang="it" title="Macro Sezione (100% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_Section.html" lang="pl" title="Makrodefinicja: Przekrój (10% translated)">polski</a></li></ul></div>
<p>(parametrique!)
</p>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/Part_Section.svg"><img decoding="async" height="32" src="../File/Part_Section.svg" width="32"/></a></span><span> </span>
Section
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Outil alternatif à l'outil <a href="Part_Section.html" title="Part Section/fr">Part Section</a> (parametrique)<br/><br/>Version macro : 1.1<br/>Date dernière modification : 2018-04-28<br/>Version FreeCAD : All<br/>Téléchargement : <a class="external text" href="https://www.freecadweb.org/wiki/images/f/f7/Part_Section.svg" rel="nofollow">ToolBar Icon</a><br/>Auteur: DeepSOIC<br/>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="User;DeepSOIC.html" title="User:DeepSOIC">DeepSOIC</a>
</td></tr>
<tr>
<th class="ctOdd">Téléchargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://www.freecadweb.org/wiki/images/f/f7/Part_Section.svg" rel="nofollow">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br/><a href="How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars/fr">Comment créer une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.1
</td></tr>
<tr>
<th class="ctOdd">Dernière modification
</th></tr>
<tr>
<td class="ctEven macro-date">2018-04-28
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation:"><span class="tocnumber">1</span> <span class="toctext">Installation:</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Utilisation"><span class="tocnumber">2</span> <span class="toctext">Utilisation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Script"><span class="tocnumber">3</span> <span class="toctext">Script</span></a></li>
</ul>
</div>
</td></tr>
</tbody></table>
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/Macro_Section_Screenshot.png"><img decoding="async" height="393" src="../File/Macro_Section_Screenshot.png" srcset="/images/b/b6/Macro_Section_Screenshot.png 1.5x" width="1000"/></a></span>
</p><p>L'outil <a href="Part_Section.html" title="Part Section/fr">Part Section</a> produit des bords avec de continuité et un grand nombre de segments (nœuds), ce qui n'est pas très approprié pour l'outil <a href="Part_Sweep.html" title="Part Sweep/fr">Sweep</a>.
</p><p>Cette macro fait le même travail et extrait les bords de la section du résultat général de la fusion (GFA). Le résultat est résultat continu et possède moins de nœuds. Il n'est pas encore parfait pour le balayage , mais le résultat est plus satisfaisant que la simple utilisation de Part Section.
</p><p>Requis FreeCAD v0.17+ built against OCC no less than 6.9.0 (tested on 7.0.0).
</p>
<h2><span class="mw-headline" id="Installation:">Installation:</span></h2>
<p>Téléchargez le fichier et sauvez les dans votre répertoire de macros:
</p><p><a class="external free" href="https://github.com/DeepSOIC/FreeCAD-Macros/raw/master/Section/MacroSection.py" rel="nofollow">https://github.com/DeepSOIC/FreeCAD-Macros/raw/master/Section/MacroSection.py</a>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<ol><li>Sélectionnez deux objets shapes et lancez la macro pour créer la section</li>
<li>Dans le menu FreeCAD: Macro → Macros... → double-cliquez sur  MacroSection.FCMacro . Un nouvel objet est créé.</li></ol>
<p>Après avoir exécuté la macro, vous pouvez ajouter un bouton sur votre barre d'outils. Allez dans Outils → Personnaliser, Barres d'outils, sélectionnez MacroSection dans la liste déroulante de gauche et ajoutez la commande à l'une de vos barres d'outils personnalisées.
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/Part_Section.svg"><img decoding="async" height="64" src="../File/Part_Section.svg" width="64"/></a></span>
</p>
<div style="clear:both"></div>
<p><b>MacroSection.py</b>
</p>
<pre>#***************************************************************************
#*                                                                         *
#*   Copyright (c) 2016 - Victor Titov (DeepSOIC)                          *
#*                                               &lt;vv.titov@gmail.com&gt;      *  
#*                                                                         *
#*   This program is free software; you can redistribute it and/or modify  *
#*   it under the terms of the GNU Lesser General Public License (LGPL)    *
#*   as published by the Free Software Foundation; either version 2 of     *
#*   the License, or (at your option) any later version.                   *
#*   for detail see the LICENCE text file.                                 *
#*                                                                         *
#*   This program is distributed in the hope that it will be useful,       *
#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
#*   GNU Library General Public License for more details.                  *
#*                                                                         *
#*   You should have received a copy of the GNU Library General Public     *
#*   License along with this program; if not, write to the Free Software   *
#*   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  *
#*   USA                                                                   *
#*                                                                         *
#***************************************************************************

__title__="Macro Section"
__author__ = "DeepSOIC"
__doc__ = '''
Macro Section.
Alternative implementation of Part Section tool.
Requires FreeCAD v0.17+ and OCC 6.9.0+

Instructions:
First of all, save this macro as MacroSection.py, into a location from where it can be imported. FC's standard macro location is the best place to do that.

Select two shapes to compute section between.
Then, in Py console:

import MacroSection
MacroSection.run()

OR

just run this file as a macro.

Parametric Section object is created.
'''
if __name__ == "__main__": #being run as a macro
    import MacroSection
    MacroSection.run()

import FreeCAD as App
if App.GuiUp:
    import FreeCADGui as Gui
import Part

def makeSectionFeature():
    '''makeSectionFeature(): makes a Section parametric feature object. Returns the new object.'''
    selfobj = App.ActiveDocument.addObject("Part::FeaturePython","Section")
    Section(selfobj)
    ViewProviderSection(selfobj.ViewObject)
    return selfobj

class Section:
    "The Section feature object"
    def __init__(self,selfobj):
        selfobj.addProperty("App::PropertyLink","Base","Section","Input shape")
        selfobj.addProperty("App::PropertyLink","Tool","Section","Input shape")
        selfobj.Proxy = self

    def execute(self,selfobj):
        import BOPTools
        import BOPTools.ShapeMerge
        from BOPTools.Utils import HashableShape
        
        if len(selfobj.Base.Shape.Faces) == 0 or len(selfobj.Tool.Shape.Faces) == 0:
            raise ValueError("Shapes must have at least one face each.")
        sh1 = Part.Compound(selfobj.Base.Shape.Faces)
        sh2 = Part.Compound(selfobj.Tool.Shape.Faces)
        pieces, map = sh1.generalFuse([sh2])
        pieces = pieces.childShapes()
        assert(len(pieces) == 2)
        
        edges1 = set([HashableShape(edge) for edge in pieces[0].Edges])
        edges2 = set([HashableShape(edge) for edge in pieces[1].Edges])
        edges_to_return = list(set.intersection(edges1, edges2))
        edges_to_return = [edge.Shape for edge in edges_to_return] #convert hashable shapes back to plain shapes
        print("returning {num} edges of total {tot}".format(num= len(edges_to_return), tot= len(edges1)+len(edges2)))
        
        selfobj.Shape = BOPTools.ShapeMerge.mergeWires(edges_to_return)

class ViewProviderSection:
    def __init__(self,vobj):
        vobj.Proxy = self
       
    def getIcon(self):
        return ":/icons/Part_Section.svg"

    def attach(self, vobj):
        self.ViewObject = vobj
        self.Object = vobj.Object
  
    def __getstate__(self):
        return None

    def __setstate__(self,state):
        return None

    def claimChildren(self):
        return [self.Object.Base, self.Object.Tool]
        
    def onDelete(self, feature, subelements): # subelements is a tuple of strings
        try:
            self.Object.Base.ViewObject.show()
            self.Object.Tool.ViewObject.show()
        except Exception as err:
            App.Console.PrintError("Error in onDelete: " + err.message)
        return True

class CommandMacroSection:
    "Command to create Section feature"
    def GetResources(self):
        return {'Pixmap'  : ":/icons/Part_Section.svg",
                'MenuText': "Section",
                'Accel': "",
                'ToolTip': "Macro_Section: alternative implementation of Part Section tool"}

    def Activated(self):
        run()
    def IsActive(self):
        if App.ActiveDocument:
            return True
        else:
            return False

if App.GuiUp:
    Gui.addCommand("Macro_Section", CommandMacroSection())

def run():
    sel = Gui.Selection.getSelectionEx()
    try:
        if len(sel) != 2:
            raise Exception("Select two shapes to compute section between, first! Then run this macro.")
        try:
            App.ActiveDocument.openTransaction("Macro Section")
            selfobj = makeSectionFeature()
            selfobj.Base = sel[0].Object
            selfobj.Tool = sel[1].Object
            selfobj.Base.ViewObject.hide()
            selfobj.Tool.ViewObject.hide()
            
            selfobj.Proxy.execute(selfobj)
        finally:
            App.ActiveDocument.commitTransaction()
    except Exception as err:
        from PySide import QtGui
        mb = QtGui.QMessageBox()
        mb.setIcon(mb.Icon.Warning)
        mb.setText(err.message)
        mb.setWindowTitle("Macro Section")
        mb.exec_()</pre>
<!-- 
NewPP limit report
Cached time: 20241129212422
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.045 seconds
Real time usage: 0.079 seconds
Preprocessor visited node count: 89/1000000
Post‐expand include size: 2019/2097152 bytes
Template argument size: 6567/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 7099/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    5.645      1 -total
 49.55%    2.797      1 Template:Macro/fr
 23.37%    1.319      1 Template:Clear
 22.76%    1.285      1 Template:MacroCode
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:73840-0!canonical and timestamp 20241129212422 and revision id 692497. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
