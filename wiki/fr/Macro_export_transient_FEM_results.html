<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro export transient FEM results/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_export_transient_FEM_results.html" lang="en" title="Macro export transient FEM results (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_export_transient_FEM_results.html" lang="it" title="Macro export transient FEM results/it (18% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_export_transient_FEM_results.html" lang="pl" title="Makrodefinicja: Eksport przejściowych wyników MES (5% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/Text-x-python.png" title="Generic macro icon. Create your personal icon with the same name of the macro"><img alt="Generic macro icon. Create your personal icon with the same name of the macro" decoding="async" height="32" src="../File/Text-x-python.png" srcset="/images/2/2c/Text-x-python.png 1.5x" width="32"/></a></span><span> </span>
export transient FEM results
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Exporte plusieurs résultats FEM à partir d'une analyse transitoire pour le post-traitement dans ParaView.<br/><br/>Macro version: 0.1<br/>Last modified: 2019-08-30<br/>FreeCAD version: All<br/>Download: <a class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing" rel="nofollow">Macro file (3 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing" rel="nofollow">Example file without results (200 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing" rel="nofollow">Example file with results (10 MB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing" rel="nofollow">All example files, including the vtk-export folder (21 MB)</a><br/>Author: Luftschraube<br/>
</td></tr>
<tr>
<th class="ctOdd">Author
</th></tr>
<tr>
<td class="ctEven macro-author"><a class="new" href="index.php?title=User;Luftschraube&amp;action=edit&amp;redlink=1.html" title="User:Luftschraube (page does not exist)">Luftschraube</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing" rel="nofollow">Macro file (3 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing" rel="nofollow">Example file without results (200 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing" rel="nofollow">Example file with results (10 MB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing" rel="nofollow">All example files, including the vtk-export folder (21 MB)</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes">Macros recipes</a><br/><a href="How_to_install_macros.html" title="How to install macros">How to install macros</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars">How to customize toolbars</a>
</td></tr>
<tr>
<th class="ctOdd">Macro Version
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Date last modified
</th></tr>
<tr>
<td class="ctEven macro-date">2019-08-30
</td></tr>
<tr>
<th class="ctOdd">FreeCAD Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Default shortcut
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Contexte"><span class="tocnumber">2</span> <span class="toctext">Contexte</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Utilisation_(pour_utilisateurs_expérimentés)"><span class="tocnumber">3</span> <span class="toctext">Utilisation (pour utilisateurs expérimentés)</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Utilisation_(pas-à-pas_avec_exemple)"><span class="tocnumber">4</span> <span class="toctext">Utilisation (pas-à-pas avec exemple)</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Téléchargements"><span class="tocnumber">5</span> <span class="toctext">Téléchargements</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Script"><span class="tocnumber">6</span> <span class="toctext">Script</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Liens"><span class="tocnumber">7</span> <span class="toctext">Liens</span></a></li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro exporte plusieurs objets de résultats FEM d'une analyse transitoire au format VTK et génère un fichier PVU qui peut être utilisé pour charger les résultats directement dans ParaView pour le post-traitement.
</p><p><span id="Background"></span>
</p>
<h2><span class="mw-headline" id="Contexte">Contexte</span></h2>
<p>Une analyse transitoire dans FreeCAD se termine par un tas d'objets résultats FEM, un pour chaque horodatage. Les résultats individuels peuvent être analysés directement dans FreeCAD et être post-traités en utilisant <a href="FEM_PostPipelineFromResult.html" title="FEM PostPipelineFromResult/fr">pipelines</a>. Cependant, les possibilités dans FreeCAD sont encore limitées, en particulier pour les analyses transitoires. Un meilleur outil pour le post-traitement et la visualisation est ParaView. Vous pouvez exporter des objets individuels de résultats FEM depuis FreeCAD sous forme de fichier .vtk ou .vtu, qui peuvent ensuite être ouverts avec ParaView. Malheureusement, le Workbench FEM ne supporte pas (encore) l'exportation de plusieurs fichiers .vtk en même temps. C'est là que cette macro entre en jeu.
</p><p><span id="How_to_use_(experienced_users)"></span>
</p>
<h2><span id="Utilisation_.28pour_utilisateurs_exp.C3.A9riment.C3.A9s.29"></span><span class="mw-headline" id="Utilisation_(pour_utilisateurs_expérimentés)">Utilisation (pour utilisateurs expérimentés)</span></h2>
<p>Exécutez la macro sur un projet FreeCAD qui inclut plusieurs objets de résultat FEM à partir d'une analyse transitoire. Outre le fichier .FCStd, un nouveau dossier 'vtk-export' sera créé, contenant les résultats individuels (fichiers .vtu) et un fichier .pvu pouvant être ouvert à partir de ParaView.
</p><p><span id="How_to_use_(step-by-step_with_example)"></span>
</p>
<h2><span id="Utilisation_.28pas-.C3.A0-pas_avec_exemple.29"></span><span class="mw-headline" id="Utilisation_(pas-à-pas_avec_exemple)">Utilisation (pas-à-pas avec exemple)</span></h2>
<p>A titre d'exemple, le pliage d'une bande bimétal aluminium/acier est utilisé. Un pas à pas pour créer l'exemple de fichier est fourni <a href="Transient_FEM_analysis.html" title="Transient FEM analysis/fr">ici</a>, ou vous pouvez télécharger le fichier à partir de la <a href="#Téléchargements">section téléchargements</a> de cette page. Enregistrez le fichier FCMacro dans le dossier de macros FreeCAD, qui peut être trouvé via Edition → Préférences → Python → Macro.
</p><p>Avec l'exemple de fichier ouvert, nous allons dans Macro → Macros ..., sélectionnez "ExportTransientResults_190830.FCMacro" (ou le nom sous lequel vous l'avez enregistré) et exécutons la. La macro va maintenant créer un sous-dossier 'vtk-export' en plus du fichier .FCStd. Selon le nombre et la taille des objets de résultat, cela peut prendre un certain temps. Dans la vue Rapport (Vue → Vue Rapport), nous devrions voir 'Macro finished' si tout s'est bien passé - ou quelques messages d'erreur. (Remarque: Parfois, des messages comme 'PropertyFloatList NOT exported to vtk' apparaissent mais j'ai quand même pu travailler avec les fichiers VTK ...) Dans le sous-dossier 'vtk-export', nous trouverons des fichiers .vtu, un pour chaque résultat défini pour chaque horodatage. De plus, un fichier .pvd est créé, qui indique à ParaView quel jeu de résultats appartient à quel horodatage. 
</p><p>Maintenant, nous ouvrons ParaView et allons dans Fichier → Ouvrir ... et ouvrons le fichier .pvd. Dans l'onglet 'Properties', nous cliquons sur 'Apply' pour charger les résultats. Dans l'onglet 'Information', nous verrons une liste <i>Index</i> et <i>Value</i>, correspondant aux horodatages des résultats que nous venons d'importer. (Bien sûr, il est toujours judicieux de vérifier si les heures indiquées ici sont correctes ou si quelque chose d'étrange s'est produit pendant l'exportation.) À partir de là, nous pouvons utiliser ParaView pour jouer avec les résultats. Étant donné que ParaView offre de nombreuses possibilités, veuillez vous référer aux documentations appropriées sur Internet. 
</p><p>À des fins de démonstration, visualisons maintenant la température de la bande bimétallique pliée: dans l'onglet 'properties' à gauche, sous 'coloring', nous sélectionnons la température, et l'image est mappée en fonction de la température locale. Via la petite icône avec un coeur, nous sélectionnons l'échelle de couleur 'cool to warm'. Avec les icônes de type enregistreur sur le dessus, nous pouvons parcourir tous les résultats individuels qui ont été créés pendant l'analyse. Le bouton 'play' affichera les images individuelles dans leur séquence. Cependant, les résultats individuels ne sont pas séparés par un intervalle de temps constant, de sorte que l'animation n'est pas proportionnelle dans le temps. 
</p><p>Ce dont nous avons besoin, c'est d'une interpolation des résultats entre les pas de temps, qui est disponible via Filters → Temporal → Temporal Interpolator. Ici, nous choisissons à nouveau la température de coloration. Dans 'animation view' (View → Animation View), nous pouvons maintenant passer du mode «séquence» au mode «temps réel». Nous pouvons également définir l'heure de début (la valeur par défaut est 0,01 s), l'heure de fin et la durée. Alors que les heures de début et de fin se réfèrent au temps de simulation, la durée est le temps réel réel que l'animation prend pour jouer complètement. Avec une durée de 10 s, notre temps de simulation de 60 s sera compressé en 10 s en temps réel.
</p><p>Nous allons plus loin et souhaitons visualiser le pliage réel de la bande. Avec l'interpolateur temporel sélectionné, nous ajoutons Filters → Common → Warp by Vector. Sous 'vectors', nous choisissons 'DisplacementVectors' et définissons le 'scale factor' à 10. Lorsque nous jouons l'animation maintenant, nous pouvons réellement voir la flexion de la bande mappée en couleur (exagérée par un facteur 10).
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Transient_FEM_Bimetal_ParaView_(1).JPG"><img decoding="async" height="543" src="../File/Transient_FEM_Bimetal_ParaView_%281%29.JPG" srcset="/images/thumb/a/a3/Transient_FEM_Bimetal_ParaView_%281%29.JPG/1050px-Transient_FEM_Bimetal_ParaView_%281%29.JPG 1.5x, /images/a/a3/Transient_FEM_Bimetal_ParaView_%281%29.JPG 2x" width="700"/></a></span>
</p>
<div style="clear:both"></div>
<p>Le post-traitement que nous venons de faire peut être enregistré comme un 'state' dans ParaView, qui peut être ouvert à tout moment et même appliqué à un ensemble de résultats différent.
</p><p><span id="Downloads"></span>
</p>
<h2><span id="T.C3.A9l.C3.A9chargements"></span><span class="mw-headline" id="Téléchargements">Téléchargements</span></h2>
<ul><li><a class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing" rel="nofollow">Macro file (3 kB)</a></li>
<li><a class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing" rel="nofollow">Exemple de fichier sans résultats (200 kB)</a></li>
<li><a class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing" rel="nofollow">Exemple de fichier avec résultats (10 MB)</a></li>
<li><a class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing" rel="nofollow">Tous les fichiers d'exemple y compris le dossier vtk-export (21 MB)</a></li></ul>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>The ToolBar Icon 
</p><p><b>Macro_export_transient_FEM_results.FCMacro</b>
</p>
<pre>#!/usr/bin/python
# -*- coding: utf-8 -*-

#
# Macro to export multiple FEM results objects from a transient analysis for
# post-processing in ParaView.
#
# Created by &lt;Luftschraube&gt; under the GNU Lesser General Public License (LGPL)
#
# Version 0.1 (30.08.2019)
#

import FreeCAD
import Fem
import feminout.importVTKResults
import os
from sys import exit

FreeCAD.Console.PrintMessage("&gt;&gt;&gt;---------Macro started\n")

#Get the file path and name of the active document 
p = FreeCAD.ActiveDocument.FileName
FilePath = "/".join(p.split("/")[:-1])
FileName = p.split("/")[-1].split(".")[0]
FreeCAD.Console.PrintMessage("File path:" + FilePath + "\n")
FreeCAD.Console.PrintMessage("File name:" + FileName + "\n")
FreeCAD.Console.PrintMessage("\n&lt;&lt;&lt;----------Macro finished with errors\n")

#Get FEM result objects into a list
FreeCAD.Console.PrintMessage("Looking for result objects...")
FEMResultObjects = []

for obj in App.ActiveDocument.Objects:
	if obj.TypeId == "Fem::FemResultObjectPython":	
		FEMResultObjects.append(obj.Label)
		#FreeCAD.Console.PrintMessage(obj.Label + '\n')

NumberOfResultObjects = len(FEMResultObjects)
FreeCAD.Console.PrintMessage(str(NumberOfResultObjects) + " found\n")

if NumberOfResultObjects &gt; 0:
	
	#Export result objects as .vtu file and generate .pvu file
	ExportFolderName = "vtk-export"
	ExportOutputPath = FilePath + "/" + ExportFolderName
	if not os.path.exists(ExportOutputPath):
		os.makedirs(ExportOutputPath)
		FreeCAD.Console.PrintMessage(ExportOutputPath + " has been created\n")
	else:
		FreeCAD.Console.PrintMessage(ExportOutputPath + " already exists\n")
	
	PVUFile = open(ExportOutputPath + "/" + FileName + ".pvd","w")
	PVUFile.write("&lt;VTKFile type=\"Collection\" version=\"1.0\" byte_order=\"LittleEndian\" header_type=\"UInt64\"&gt;\n\t&lt;Collection&gt;\n")
	
	n = 0
	for ExportObject in sorted(FEMResultObjects):
		n = n + 1
		
		#Read and format time stamp (e.g., 12.37 s = 0001237)
		FreeCADResultLabelParts = ExportObject.split("_")
		PreDecimal = FreeCADResultLabelParts[-3]
		PostDecimal = FreeCADResultLabelParts[-2]

		if len(PostDecimal) == 1:
			PostDecimal = PostDecimal + str(0)
		TimeValue = float(PreDecimal) + float(PostDecimal)/100
		TimeString = str(int(round(TimeValue*100,0))).zfill(7)
	
		#For some reason, the VTK exporter expects a list (although only one object is processed at once...) - so build a list with the current object
		ExportObjectList = []
		ExportObjectList.append(FreeCAD.ActiveDocument.getObject(ExportObject))
		FileNameOUT = FileName + "_" + TimeString + ".vtu"
		FilePath = ExportOutputPath + "/" + FileNameOUT
		FreeCAD.Console.PrintMessage(FilePath + " is to be created\n")
		feminout.importVTKResults.export(ExportObjectList,FilePath)
	
		PVUFile.write("\t\t&lt;DataSet timestep=\"" + str(TimeValue) + "\" file=\"" + FileNameOUT + "\"/&gt;\n")
	
	#Close the .pvu file
	PVUFile.write("\t&lt;/Collection&gt;\n&lt;/VTKFile&gt;")
	PVUFile.close()
else:
	FreeCAD.Console.PrintMessage("Nothing to export!")

FreeCAD.Console.PrintMessage('\n&lt;&lt;&lt;----------Macro finished\n')</pre>
<p><br/>
<span id="Link"></span>
</p>
<h2><span class="mw-headline" id="Liens">Liens</span></h2>
<p>Exemple <a class="external text" href="https://www.freecadweb.org/wiki/Transient_FEM_analysis/fr" rel="nofollow">Analyse FEM transitoire</a>.
</p><p>Discussion sur le forum <a class="external text" href="https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=37650" rel="nofollow">Export transient FEM results to vtk/vtu for ParaView</a>
</p>
<!-- 
NewPP limit report
Cached time: 20241129210416
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.060 seconds
Real time usage: 0.099 seconds
Preprocessor visited node count: 116/1000000
Post‐expand include size: 3784/2097152 bytes
Template argument size: 4824/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 4018/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    3.994      1 -total
 56.66%    2.263      1 Template:Macro
 24.74%    0.988      1 Template:MacroCode
 14.82%    0.592      1 Template:Clear
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:175449-0!canonical and timestamp 20241129210415 and revision id 1296957. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
