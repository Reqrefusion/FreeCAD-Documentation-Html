<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro TNP Solution/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_TNP_Solution.html" lang="en" title="Macro TNP Solution (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_TNP_Solution.html" lang="pl" title="Makrodefinicja: Rozwiązanie TNP (4% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution.png"><img decoding="async" height="26" src="../File/TNP_solution.png" srcset="/images/thumb/e/e4/TNP_solution.png/48px-TNP_solution.png 1.5x, /images/thumb/e/e4/TNP_solution.png/64px-TNP_solution.png 2x" width="32"/></a></span><span> </span>
Macro TNP solution
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Il s'agit d'une solution pour le problème de dénomination topologique<br/><br/>Version macro : 1.0<br/>Date dernière modification : 2022-08-16<br/>Téléchargement : <a class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png" rel="nofollow">Icône de la barre d'outils</a><br/>Auteur: Dprojects<br/>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="User;Dprojects.html" title="User:Dprojects">Dprojects</a>
</td></tr>
<tr>
<th class="ctOdd">Téléchargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png" rel="nofollow">Icône de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br/><a href="How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars/fr">Comment créer une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Dernière modification
</th></tr>
<tr>
<td class="ctEven macro-date">2022-08-16
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Code_pour_l'exemple"><span class="tocnumber">2</span> <span class="toctext">Code pour l'exemple</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#LA_solution"><span class="tocnumber">3</span> <span class="toctext">LA solution</span></a></li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution.gif"><img decoding="async" height="694" src="../File/TNP_solution.gif" width="1362"/></a></span>
</p><p>Il s'agit d'une solution pour le problème de dénomination  décrit à la page : <a href="Topological_naming_problem.html" title="Topological naming problem/fr">Problème de dénomination topologique</a>.
</p><p>Si vous construisez un objet sur un autre objet, ainsi qu'une esquisse, il est simple à résoudre, car vous savez deux choses :
</p>
<ol><li>Les points de l'esquisse font toujours partie de la face inférieure.</li>
<li>L'esquisse et la face inférieure sont dans le même plan.</li></ol>
<p>Pour résoudre le problème du problème de dénomination topologique, vous pouvez :
</p><p><b>Sauvegardez la clé avant toute opération :</b>
</p><p>Il suffit de sauvegarder la clé avant toute opération. Dans l'exemple décrit à la page <a href="Topological_naming_problem.html" title="Topological naming problem/fr">Problème de dénomination topologique</a>, l'objet se trouve dans le plan XY. J'utilise donc la valeur de l'axe Z du centre de Sketch BoundBox :
</p>
<pre>ad = FreeCAD.ActiveDocument
p2 = ad.Pad002
s2 = p2.Profile[0]
key = round(s2.Shape.BoundBox.Center[2], precision)</pre>
<p><b>Ensuite, recherchez la clé stockée sur toutes les faces :</b>
</p><p>Après le redimensionnement, je recherche la clé stockée sur toutes les faces. Parce que si l'esquisse et la face étaient sur le même plan XY, la valeur de l'axe Z était la même pour les deux. Dans l'atelier PartDesign, vous ne pouvez pas déplacer le troisième bloc au-dessus du deuxième bloc, pour avoir un espace entre les deux, c'est un objet unique, le bloc suivant avec l'esquisse touchera toujours la face. Sur la nouvelle face, la valeur de l'axe Z sera toujours la même que la clé stockée. Donc, il faut retourner l'index de la face. Il n'y a rien de plus à faire. 
</p>
<pre>def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		if bb == iBB:
			return index

	return -1</pre>
<p><b>Dernières étapes</b>
</p><p>À la fin, j'assigne la nouvelle face à l'esquisse et je recalcule. Pour être honnête, la partie la plus difficile a été d'assigner la face à Sketch.Support, pour moi la syntaxe est époustouflante ;-)
</p><p><span id="Code_for_the_example"></span>
</p>
<h2><span id="Code_pour_l.27exemple"></span><span class="mw-headline" id="Code_pour_l'exemple">Code pour l'exemple</span></h2>
<p>Le fichier de test a été téléchargé sur le forum FreeCAD : <a class="external text" href="https://forum.freecadweb.org/download/file.php?id=198537" rel="nofollow">TNP.FCStd</a>. 
</p>
<pre>__Title__="TNP_solution"
__Author__ = "Dprojects"
__Version__ = "1.0"
__Date__    = "2022-08-16"
__Comment__ = ""
__Web__ = "https://github.com/dprojects/Woodworking"
__Wiki__ = "https://wiki.freecadweb.org/TNP_solution"
__Icon__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__IconW__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__Help__ = "solution for Topological Naming Problem"
__Status__ = "stable"
__Requires__ = ""
__Communication__ = "http://www.freecadweb.org/wiki/index.php?title=User:Dprojects"

# ####################################################################
#
# This is solution for Topological Naming Problem described at 
# https://wiki.freecadweb.org/Topological_naming_problem
#
# MIT License
# 
# Copyright (c) 2022 Darek L github.com/dprojects
# 
# Permission is hereby granted, free of charge, to any 
# person obtaining a copy of this software and associated 
# documentation files (the "Software"), to deal in the 
# Software without restriction, including without limitation 
# the rights to use, copy, modify, merge, publish, distribute, 
# sublicense, and/or sell copies of the Software, and to permit 
# persons to whom the Software is furnished to do so, subject 
# to the following conditions:
# 
# The above copyright notice and this permission notice shall 
# be included in all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
# OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
# HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
# DEALINGS IN THE SOFTWARE.
# 
# ####################################################################

import FreeCAD

# this should be set according 
# FreeCAD user GUI precision settings
precision = 5

# global settings
ad = FreeCAD.ActiveDocument

# middle object to be resized
p1 = ad.Pad001
s1 = p1.Profile[0]

# top object bottom to store key
p2 = ad.Pad002
s2 = p2.Profile[0]

# ####################################################################
def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		
		FreeCAD.Console.PrintMessage("\n")
		FreeCAD.Console.PrintMessage(index)
		FreeCAD.Console.PrintMessage(" ")
		FreeCAD.Console.PrintMessage(bb)

		if bb == iBB:
			FreeCAD.Console.PrintMessage(" &lt;=== found")
			return index

	return -1

# ####################################################################
def makeTNP():

	# set key
	key = round(s2.Shape.BoundBox.Center[2], precision)

	# resize and cause TNP
	s1.setDatum(9, FreeCAD.Units.Quantity('350'))

	# recompute
	s1.recompute()
	p1.recompute()
	ad.recompute()

	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Stored key:"+str(key))
	FreeCAD.Console.PrintMessage("\n")

	# search all faces for solution
	solutionIndex = getFaceIndex(p1, key)
	solution = "Face"+str(solutionIndex)
	
	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Solution: "+solution)
	
	# set exact face to Sketch
	s2.Support = (p1, (solution,))
	ad.recompute()

# ####################################################################
def moveBack():

	s1.setDatum(9, FreeCAD.Units.Quantity('250'))
	s2.Support = (p1, ('Face13',))
	ad.recompute()

# ####################################################################
# main
# ####################################################################

# uncomment what you want
makeTNP()
#moveBack()

# ####################################################################</pre>
<p><span id="THE_Solution"></span>
</p>
<h2><span class="mw-headline" id="LA_solution">LA solution</span></h2>
<p>Le code ci-dessus montre comment résoudre l'exemple du problème de dénomination topologique décrit à la page : <a href="Topological_naming_problem.html" title="Topological naming problem/fr">Problème de dénomination topologique</a> mais exactement les mêmes règles que vous pouvez utiliser pour résoudre d'autres problèmes. L'approche est simple :
</p>
<ol><li>Mémorisation de la clé avant toute opération</li>
<li>Recherche de la clé après l'opération</li></ol>
<p>L'implémentation particulière peut être différente. Dans cet exemple, le plan est XY, mais vous pouvez faire exactement la même chose pour d'autres axes. Vous pouvez également choisir d'autres clés. Dans le cadre du projet <a class="external text" href="https://github.com/dprojects/Woodworking" rel="nofollow">Woodworking</a>, j'effectue de nombreuses opérations sur des objets inexistants, ce qui m'a obligé à résoudre le problème du nom topologique à plusieurs reprises. 
</p><p>Ici, je change les objets Cube en objets Epaisseur de PartDesign :
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution_1.gif"><img decoding="async" height="694" src="../File/TNP_solution_1.gif" width="1362"/></a></span>
</p><p>Dans l'exemple ci-dessous, je change les Cubes en Chanfreins de PartDesign, j'ai donc dû stocker la clé pour les bords : 
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution_2.gif"><img decoding="async" height="694" src="../File/TNP_solution_2.gif" width="1362"/></a></span>
</p><p>L'exemple ci-dessous est un peu plus compliqué car comme vous le voyez à l'écran, les références à l'objet et à la face changent automatiquement. Mais aussi pour faire un trou j'appelle une fonction définie dans ma bibliothèque et non directement dans l'outil. Donc, j'ai dû utiliser une petite astuce avec la sélection et la désélection, pour obtenir une nouvelle référence :
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution_3.gif"><img decoding="async" height="694" src="../File/TNP_solution_3.gif" width="1362"/></a></span>
</p><p><br/>
Il existe de nombreux problèmes de ce type lors de la programmation dans FreeCAD, mais ils peuvent tous être résolus de la même manière. J'espère que cela vous aidera.
</p><p><br/>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20241129210825
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.046 seconds
Real time usage: 0.093 seconds
Preprocessor visited node count: 109/1000000
Post‐expand include size: 2142/2097152 bytes
Template argument size: 4564/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 4794/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    9.187      1 -total
 51.85%    4.763      1 Template:Macro/fr
 31.48%    2.892      3 Template:MacroCode
 12.73%    1.170      1 Template:Clear
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:296770-0!canonical and timestamp 20241129210825 and revision id 1346040. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
