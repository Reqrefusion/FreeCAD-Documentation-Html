<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Add FEM Equation Tutorial/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../de\Add_FEM_Equation_Tutorial.html" lang="de" title="Tutorium FEM Gleichung hinzufügen (100% translated)">Deutsch</a></li>
<li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../Add_FEM_Equation_Tutorial.html" lang="en" title="Add FEM Equation Tutorial (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../it\Add_FEM_Equation_Tutorial.html" lang="it" title="Tutorial Aggiungere equazione FEM (100% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../pl\Add_FEM_Equation_Tutorial.html" lang="pl" title="Poradnik: Dodawanie równań w środowisku MES (100% translated)">polski</a></li>
<li><a class="mw-pt-progress mw-pt-progress--med" dir="ltr" href="../ro\Add_FEM_Equation_Tutorial.html" lang="ro" title="Adaugă Ecuația Analiza Elementului Finit Tutorial (54% translated)">română</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="../ru\Add_FEM_Equation_Tutorial.html" lang="ru" title="Руководство по добавлению уравнений в верстак FEM (3% translated)">русский</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="width: 230px; float: right; margin-left: 1em">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;"><span typeof="mw:File"><span><img decoding="async" height="32" src="../File/Freecad.svg" width="32"/></span></span> Tutoriel
</td></tr>
<tr>
<th class="ctOdd">Thème
</th></tr>
<tr>
<td class="ctEven">Ajouter des équations FEM
</td></tr>
<tr>
<th class="ctOdd">Niveau
</th></tr>
<tr>
<td class="ctEven">Avancé
</td></tr>
<tr>
<th class="ctOdd">Temps d'exécution estimé
</th></tr>
<tr>
<td class="ctEven">1 jour
</td></tr>
<tr>
<th class="ctOdd">Auteurs
</th></tr>
<tr>
<td class="ctEven"><a class="new" href="../index.php?title=User;JohnWang&amp;action=edit&amp;redlink=1.html" title="User:JohnWang (page does not exist)">JohnWang</a>
</td></tr>
<tr>
<th class="ctOdd">Version de FreeCAD
</th></tr>
<tr>
<td class="ctEven">0.19
</td></tr>
<tr>
<th class="ctOdd">Fichiers exemples
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Ajout_d'un_nouveau_type_d'équation"><span class="tocnumber">2</span> <span class="toctext">Ajout d'un nouveau type d'équation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#L'objet_équation_d'Elmer"><span class="tocnumber">3</span> <span class="toctext">L'objet équation d'Elmer</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Mots-clés"><span class="tocnumber">3.1</span> <span class="toctext">Mots-clés</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Modification_des_fichiers"><span class="tocnumber">3.2</span> <span class="toctext">Modification des fichiers</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Extension_de_l'objet_du_solveur"><span class="tocnumber">4</span> <span class="toctext">Extension de l'objet du solveur</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Extension_de_l'analyse_à_l'export"><span class="tocnumber">5</span> <span class="toctext">Extension de l'analyse à l'export</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Outil_de_l'interface_graphique_pour_créer_une_équation"><span class="tocnumber">6</span> <span class="toctext">Outil de l'interface graphique pour créer une équation</span></a></li>
</ul>
</div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>Dans ce tutoriel, nous allons ajouter l'équation de flux à FreeCAD et implémenter le support pour le solveur Elmer. Assurez-vous d'avoir lu et compris <a href="../fr\Extend_FEM_Module.html" title="Extend FEM Module/fr">Module d'extension FEM</a> avant de lire ce tutoriel.
</p><p>La tâche peut être divisée en quatre parties: 
</p>
<ul><li>La première étape consiste à informer l'atelier de travail FEM d'un nouveau type d'équation. Cette étape ne doit être effectuée que si l'équation n'existe pas encore dans FreeCAD (par opposition à une équation qui est déjà dans FreeCAD mais qui n'est pas prise en charge par le solveur cible).</li>
<li>La deuxième étape consiste à ajouter un objet document représentant l’équation spécifique d’Elmer.</li>
<li>La troisième étape consiste à ajouter la prise en compte de la nouvelle équation dans le solveur d'Elmer.</li>
<li>Après cela, l'exportation d'analyse sous Elmer doit être étendue pour prendre en charge le nouveau type d'équation.</li></ul>
<p><span id="New_equation_type"></span>
</p>
<h2><span id="Ajout_d.27un_nouveau_type_d.27.C3.A9quation"></span><span class="mw-headline" id="Ajout_d'un_nouveau_type_d'équation">Ajout d'un nouveau type d'équation</span></h2>
<p>Dans cette étape, nous allons modifier le fichier suivant:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/equationbase.py</span></li></ul>
<p>Le type d'équation est partagé entre tous les objets équation des différents solveurs. Chaque type a un spécificateur de chaîne (par exemple, "Heat") et une commande dédiée qui ajoute l'équation au solveur sélectionné. Cela permet une interface graphique plus simple où nous n'avons qu'un seul bouton pour l'équation de chaleur qui est utilisé pour tous les solveurs supportés.
</p><p>Tout d'abord, ajoutez la nouvelle équation au module <code>equationbase.py</code>. Chaque équation nécessite deux classes. Un proxy de document et un proxy de vue. Ces deux classes seront utilisées plus tard comme classes de base pour les classes d'équation spécifiques à Elmer. Il suffit de les copier-coller depuis un type d'équation existant et d'ajuster le chemin de l'icône dans <code>getIcon(self)</code> du proxy d'affichage.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">FlowProxy</span><span class="p">(</span><span class="n">BaseProxy</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">FlowViewProxy</span><span class="p">(</span><span class="n">BaseViewProxy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">":/icons/FEM_EquationFlow.svg"</span>
</pre></div>
<p><span id="New_Elmer's_equation_object"></span>
</p>
<h2><span id="L.27objet_.C3.A9quation_d.27Elmer"></span><span class="mw-headline" id="L'objet_équation_d'Elmer">L'objet équation d'Elmer</span></h2>
<p>Dans cette étape, nous allons modifier le fichier suivant:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/elmer/equations/flow.py</span></li></ul>
<p>et ajoutez le nouveau fichier suivant:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/ObjectsFem.py</span></li>
<li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/CMakeLists.txt</span></li></ul>
<p>Commençons par le module qui implémente l'objet document. Il peut être copié à partir d'une équation existante.
</p>
<ul><li>Si la nouvelle équation ne prend en charge que les mots-clés des systèmes <b>linéaires</b>, copiez le module <code>femsolver/elmer/equations/elasticity.py</code>.</li>
<li>S'il prend également en charge les mots-clés <b>non linéaires</b>, copiez <code>femsolver/elmer/equations/heat.py</code>.</li></ul>
<p>L'équation de l'écoulement dans Elmer est une équation potentiellement non linéaire. Cela signifie que nous allons focaliser notre travail sur <code>heat.py</code>.
</p><p><span id="Keywords"></span>
</p>
<h3><span id="Mots-cl.C3.A9s"></span><span class="mw-headline" id="Mots-clés">Mots-clés</span></h3>
<ul><li>Si la nouvelle équation ne supporte que les mots-clés pour les systèmes "linéaires", copiez le module <code>femsolver/elmer/equations/elasticity.py</code>.</li>
<li>Si la nouvelle équation supporte les mots-clés pour les systèmes <i>linéaires</i> et <i>non linéaires</i>, copiez le module <code>femsolver/elmer/equations/heat.py</code>.</li></ul>
<p>L'équation du flux dans Elmer est une équation potentiellement non linéaire. Cela signifie que nous allons baser notre travail sur <code>heat.py</code>.
</p><p><span id="Editing_files"></span>
</p>
<h3><span class="mw-headline" id="Modification_des_fichiers">Modification des fichiers</span></h3>
<p>Après avoir copié <code>heat.py</code> dans <code>flow.py</code>, ajustez
</p>
<ul><li>l’argument name de la fonction create module,</li>
<li>l’attribut Type de la classe Proxy</li>
<li>les classes de base des classes <code>Proxy</code> et <code>ViewProxy</code></li>
<li>ainsi que les propriétés ajoutées via la fonction <code>obj.addProperty(..)</code> à ceux requis par l'équation.</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"'''Flow'''"</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">femutils</span><span class="o">.</span><span class="n">createObject</span><span class="p">(</span>
        <span class="n">doc</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Proxy</span><span class="p">,</span> <span class="n">ViewProxy</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Proxy</span><span class="p">(</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">Proxy</span><span class="p">,</span> <span class="n">equationbase</span><span class="o">.</span><span class="s1">'''Flow'''</span><span class="n">Proxy</span><span class="p">):</span>

    <span class="n">Type</span> <span class="o">=</span> <span class="s2">"Fem::EquationElmer'''Flow'''"</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Proxy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">class</span> <span class="nc">ViewProxy</span><span class="p">(</span><span class="n">nonlinear</span><span class="o">.</span><span class="n">ViewProxy</span><span class="p">,</span> <span class="n">equationbase</span><span class="o">.</span><span class="s1">'''Flow'''</span><span class="n">ViewProxy</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Ensuite, vous devez changer les propriétés ajoutées via la fonction <code>obj.addProperty(..)</code> pour celles nécessaires à l'équation.
</p><p>Au moment de la rédaction de ce tutoriel, l'équation de flux Elmer n'a aucunes propriétés particulières. Voir l'équation d'élasticité d'Elmer pour un exemple avec des propriétés.
</p><p>Enfin, il faut enregistrer une définition de <b>makeEquationStatcurrent</b> dans <code>ObjectsFem.py</code> en dupliquant une entrée disponible.
</p><p>Enfin et surtout, enregistrez le nouveau fichier de module (<code>flow.py</code>) dans les deux fichiers <code>src/Mod/Fem/CMakeLists.txt</code> comme décrit dans <a class="external text" href="https://www.freecadweb.org/wiki/Extend_FEM_Module/fr" rel="nofollow">Module d'extension FEM</a>. Les listes appropriées peuvent être facilement trouvées en recherchant les fichiers de modules d’équations existants d’Elmer.
</p><p><span id="Extend_Solver_Object"></span>
</p>
<h2><span id="Extension_de_l.27objet_du_solveur"></span><span class="mw-headline" id="Extension_de_l'objet_du_solveur">Extension de l'objet du solveur</span></h2>
<p>Dans cette étape, nous allons modifier le fichier suivant:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/elmer/solver.py</span></li></ul>
<p>À l'heure actuelle, nous avons informé FreeCAD qu'il existe un nouveau type d'équation et nous avons même ajouté une commande qui ajoute cette équation à l'objet solveur sélectionné. Nous avons également implémenté un objet d'équation concret pour Elmer. Que reste-t-il à faire maintenant pour faire le lien entre Elmer et l'équation de débit. Cela doit être fait directement dans l'objet solveur Elmer.
</p><p>Enregistrez le module dans lequel nous venons d'implémenter notre nouvel objet équation (<code>flow.py</code>) avec le spécificateur d'équation de l'étape 1 ("Flow") dans la liste <code>_EQUATIONS</code> dans <code>elmer/solver.py</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">.equations</span> <span class="kn">import</span> <span class="n">electrostatic</span>
<span class="o">+</span><span class="kn">from</span> <span class="nn">.equations</span> <span class="kn">import</span> <span class="n">flow</span>

<span class="o">...</span>

<span class="n">_EQUATIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Heat"</span><span class="p">:</span> <span class="n">heat</span><span class="p">,</span>
    <span class="s2">"Elasticity"</span><span class="p">:</span> <span class="n">elasticity</span><span class="p">,</span>
<span class="o">+</span>    <span class="s2">"Flow"</span><span class="p">:</span> <span class="n">flow</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
<p><span id="Extend_writer_object"></span>
</p>
<h2><span id="Extension_de_l.27analyse_.C3.A0_l.27export"></span><span class="mw-headline" id="Extension_de_l'analyse_à_l'export">Extension de l'analyse à l'export</span></h2>
<p>Dans cette étape, nous allons modifier le fichier suivant:
</p>
<ul><li><span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">src/Mod/Fem/femsolver/elmer/writer.py</span></li></ul>
<p>C'est la partie la plus exigeante de la mise en œuvre d'une nouvelle équation. Ce fichier contient la classe <code>Writer</code> qui exporte l'analyse au format sif d'Elmer.
</p><p>Pour chaque équation prise en charge, il existe une série de méthodes gérant l'exportation de l'équation respective. Copiez-les simplement à partir d'une équation existante et ajustez-les à vos besoins. Notre équation de flux utilise les méthodes suivantes:
</p>
<ul><li><code>_getFlowSolver</code></li>
<li><code>_handleFlow</code></li></ul>
<p>Vous devez enregistrer la méthode <code>_handleFlow</code> dans la classe <code>Writer</code> :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">Writer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="o">...</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handleFlow</span><span class="p">()</span>

<span class="o">...</span>
</pre></div>
<p><code>_handleFlow</code> peut contrôler une série d'autres méthodes détaillées. Notre équation de flux utilise les méthodes détaillées suivantes :
</p>
<ul><li><code>_handleFlowConstants</code></li>
<li><code>_handleFlowMaterial</code></li>
<li><code>_handleFlowInitialVelocity</code></li>
<li><code>_handleFlowBndConditions</code></li>
<li><code>_handleFlowEquation</code></li></ul>
<p>Nous avons maintenant terminé la partie fonction de la nouvelle équation. Ensuite, nous allons connecter la nouvelle équation à travers l'interface graphique.
</p><p><span id="Gui_tool_to_create_an_equation"></span>
</p>
<h2><span id="Outil_de_l.27interface_graphique_pour_cr.C3.A9er_une_.C3.A9quation"></span><span class="mw-headline" id="Outil_de_l'interface_graphique_pour_créer_une_équation">Outil de l'interface graphique pour créer une équation</span></h2>
<p>Nous venons de créer une nouvelle classe d'équation. Pour y accéder depuis l'interface graphique FEM, nous devons créer un bouton et le lier à la nouvelle classe d'équation. Voici un tutoriel : <a href="../fr\Add_Button_to_FEM_Toolbar_Tutorial.html" title="Add Button to FEM Toolbar Tutorial/fr">Tutoriel Ajouter un bouton à la barre d'outils FEM</a>.
</p>
<!-- 
NewPP limit report
Cached time: 20241214203444
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.068 seconds
Real time usage: 0.469 seconds
Preprocessor visited node count: 340/1000000
Post‐expand include size: 2812/2097152 bytes
Template argument size: 1541/2097152 bytes
Highest expansion depth: 4/100
Expensive parser function count: 4/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 6189/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  373.132      1 -total
 98.16%  366.272      4 Template:Code
  0.70%    2.629      1 Template:TutorialInfo/fr
  0.35%    1.292     31 Template:Incode
  0.23%    0.861      6 Template:FileName
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:141632-0!canonical and timestamp 20241214203443 and revision id 1354683. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
