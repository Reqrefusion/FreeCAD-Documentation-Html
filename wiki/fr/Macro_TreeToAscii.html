<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro TreeToAscii/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../Macro_TreeToAscii.html" lang="en" title="Macro TreeToAscii (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="../it\Macro_TreeToAscii.html" lang="it" title="Macro TreeToAscii (12% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="../pl\Macro_TreeToAscii.html" lang="pl" title="Makrodefinicja: TreeToAscii (6% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/Text-x-python.png" title="Generic macro icon"><img alt="Generic macro icon" decoding="async" height="32" src="../File/Text-x-python.png" width="32"/></a></span><span> </span>
Macro TreeToAscii
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cette macro génère une représentation graphique ASCII de l'arborescence du ou des objets sélectionnés.<br/><br/>Version macro : 0.6<br/>Date dernière modification : 2020-03-23<br/>Version FreeCAD : 0.17+<br/>Auteur: OpenBrain<br/>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a class="new" href="../index.php?title=User;OpenBrain&amp;action=edit&amp;redlink=1.html" title="User:OpenBrain (page does not exist)">OpenBrain</a>
</td></tr>
<tr>
<th class="ctOdd">Téléchargement
</th></tr>
<tr>
<td class="ctEven macro-download"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr\Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br/><a href="../fr\How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br/><a href="../fr\Customize_Toolbars.html" title="Customize Toolbars/fr">Comment créer une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.6
</td></tr>
<tr>
<th class="ctOdd">Dernière modification
</th></tr>
<tr>
<td class="ctEven macro-date">2020-03-23
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17+
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Utilisation"><span class="tocnumber">2</span> <span class="toctext">Utilisation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Installation"><span class="tocnumber">3</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Script"><span class="tocnumber">4</span> <span class="toctext">Script</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Discussion_du_forum"><span class="tocnumber">4.1</span> <span class="toctext">Discussion du forum</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Code"><span class="tocnumber">4.2</span> <span class="toctext">Code</span></a></li>
</ul>
</li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro a été écrite dans le but principal de documenter la construction du modèle. Elle génère une représentation graphique ASCII de l'arborescence de la  construction du ou des objet(s) sélectionné(s).
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<p>Sélectionnez simplement le ou les objets dont vous souhaitez imprimer l'arborescence et exécutez la macro. Elle affichera l'arborescence de chaque objet dans une boîte de dialogue. Tous les objets sélectionnés seront considérés comme étant au même niveau de hiérarchie en haut de l'arborescence (même s'ils ne sont pas dans le modèle réel). Une fois la boîte de dialogue ouverte, vous pouvez changer de style et/ou de motif et recréer l'arborescence en ASCII.
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/FCTree2Ascii.png"><img decoding="async" height="487" src="../File/FCTree2Ascii.png" width="949"/></a></span>
</p><p>Plusieurs styles sont fournis, pour l'instant principalement pour prendre en charge les systèmes qui peuvent rencontrer des problèmes avec le codage Unicode :
</p>
<ul><li><i><b>Modern</b></i> : (par défaut) utilise des caractères Unicode pour afficher les fourches et les branches</li>
<li><i><b>Baroque</b></i> : un autre style Unicode avec une plus grande indentation</li>
<li><i><b>ASCII</b></i> : représentation ASCII pure des fourches et branches</li></ul>
<p>La création de votre propre style ne devrait pas être trop difficile en modifiant la macro et en changeant/ajoutant un style à la variable "STYLES". Le choix du style sélectionné est enregistré dans les paramètres FreeCAD.
</p><p>Le motif de ligne peut être personnalisé. Il prend en charge différentes métadonnées définies :
</p>
<ul><li><i><b>{LBL}</b></i> : objet étiquette Label (étiquette affichée)</li>
<li><i><b>{NAM}</b></i> : objet nom Name (nom interne) par ex. "Box001"</li>
<li><i><b>{SNAM}</b></i> : objet nom court ShortName (sans chiffres) par exemple. 'Box001' sera affiché comme 'Box'</li>
<li><i><b>{TYP}</b></i> : objet Type par exemple. 'Part::MultiFuse'</li>
<li><i><b>{BTYP}</b></i> : objet BaseType par exemple. "Part::MultiFuse" sera affiché comme "Part"</li>
<li><i><b>{STYP}</b></i> : objet ShortType (sans base) par ex. "Part::MultiFuse" sera affiché comme "MultiFuse"</li></ul>
<p>Le modèle par défaut est "{LBL} ({SNAM})", ce qui signifie par exemple que l'objet "Box001" étiqueté "myCube" sera affiché comme "myCube (Box001)".
Notez que pratiquement tous les caractères sont autorisés. Si vous souhaitez imprimer des accolades, vous devez les doubler. Par exemple, avec le même objet d'exemple, le modèle "{LBL} (SNAME) {{{TYP}}} =&gt;" affichera "myCube (Box) {Part::Box} =&gt;". Les métadonnées disponibles sont disponibles dans l'info-bulle du champ d'édition de motif, vous n'avez donc pas besoin de vous en souvenir. Le motif de la ligne est enregistré dans les paramètres FreeCAD.
</p><p>Une fois la boîte de dialogue ouverte, plusieurs actions sont disponibles :
</p>
<ul><li><i><b>Copy to clipboard</b></i> : copie tout l'arborescence dans votre presse-papiers</li>
<li><i><b>Save to file</b></i> : enregistre l'arborescence entière dans un fichier arbitraire sur votre système</li>
<li><i><b>Embed in text file</b></i> : stocke l'arborescence entière dans un fichier texte incorporé dans le document (disponible depuis FC 0.18.4)</li>
<li>Bien sûr, vous pouvez copier n'importe quelle partie de l'arborescence en la sélectionnant et en utilisant les commandes de copie standard.</li></ul>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>La macro est disponible via le <a href="../fr\Std_AddonMgr.html" title="Std AddonMgr/fr">gestionnaire des extensions</a>.
Le code est fourni sur cette page pour plus de commodité au cas où votre système n'ait pas git-python. Bien qu'elle devrait être à jour, la dernière version de la macro est toujours disponible sur <a class="external text" href="https://github.com/FreeCAD/FreeCAD-macros/blob/master/Information/TreeToAscii.FCMacro" rel="nofollow">dépôt FreeCAD-macro</a>
</p><p>Pour des explications plus détaillées, consultez la page <a href="../fr\How_to_install_macros.html" title="How to install macros/fr">Comment installer les macros</a>.
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p><span id="Forum_discussion"></span>
</p>
<h3><span class="mw-headline" id="Discussion_du_forum">Discussion du forum</span></h3>
<p>Pour tout commentaire (bug, demande de fonctionnalité, commentaires...), merci d'utiliser ce fil de discussion : <a class="external free" href="https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=43504" rel="nofollow">https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=43504</a>
</p>
<h3><span class="mw-headline" id="Code">Code</span></h3>
<p><b>Macro_FCTree2Ascii.FCMacro</b>
</p>
<pre>#!/usr/bin/python
#####################################
# Copyright (c) openBrain 2020
# Licensed under LGPL v2
#
# This FreeCAD macro prints the Tree of selected object(s) as ASCII art.
# Several styles are available. Tree branch pattern is customizable.
# It can export to clipboard, file or embedded text document.
# This mainly aims at documenting the model.
#
# Version history :
# *0.6 : introduce last fork string definition, add new style
# *0.5 : beta release
#
#####################################

# -*- coding: utf-8 -*-

__Name__ = 'TreeToAscii'
__Comment__ = 'Prints the Tree of selected object(s) as ASCII art'
__Author__ = 'openBrain'
__Version__ = '0.6'
__Date__ = '2020-03-23'
__License__ = 'LGPL v2'
__Web__ = 'https://www.freecadweb.org/wiki/Macro_TreeToAscii'
__Wiki__ = 'https://www.freecadweb.org/wiki/Macro_TreeToAscii'
__Icon__ = ''
__Help__ = 'Select object(s) you want to print the tree then run'
__Status__ = 'Beta'
__Requires__ = 'FreeCAD &gt;= 0.17'
__Communication__ = 'https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=43504'

import FreeCAD as App
import FreeCADGui as Gui
from PySide import QtGui, QtCore  # Special FreeCAD's PySide, which may be PySide2!

PREF_PATH = 'User parameter:BaseApp/Preferences/Mod/TreeToAscii'
PREF_PATTERN = 'TreePattern'
PREF_STYLE = 'TreeStyle'
STYLES = {  # defines styles as NAME : [ branch str, fork str, opt:last fork str]
    'Modern' : [' │ ', ' ├ ', ' └ '],  # Unicode U+251C, Unicode U+2502
    'Baroque' : [' │  ', ' ├─ ',  ' └─ '],
    'ASCII' : [' | ', ' \\_']
    }
DEF_PATTERN = '{LBL} ({SNAM})'
DEF_STYLE = list(STYLES.keys())[0]

g_ascii_tree=""

def printChildren(objs=None, level=0, baseline=''):
    """Build ASCII tree by recursive call"""
    global g_ascii_tree
    for cnt, obj in enumerate(objs,1):
        data = {
            "LBL" : obj.Label,
            "NAM" : obj.Name,
            "SNAM" : "".join(filter(str.isalpha, obj.Name)),
            "TYP" : obj.TypeId,
            "BTYP" : obj.TypeId.partition('::')[0],
            "STYP" : obj.TypeId.rpartition('::')[-1]
        }
        branch_str = STYLES[gen_style.currentText()][0]
        fork_str = STYLES[gen_style.currentText()][1]
        last_fork_str = STYLES[gen_style.currentText()][-1]
        if cnt == len(objs):
            g_ascii_tree += baseline + last_fork_str
        else:
            g_ascii_tree += baseline + fork_str
        try:
            g_ascii_tree += gen_pattern.text().format(**data)
        except (ValueError, IndexError, KeyError):
            g_ascii_tree = 'Error in generating pattern'
            return
        g_ascii_tree += '\n'
        if cnt == len(objs):
            baselinechi = baseline + ' '*len(branch_str)
        else:
            baselinechi = baseline + branch_str
        printChildren(obj.ViewObject.claimChildren(), level + 1, baselinechi)

def copyToClip():
    """Copies ASCII tree to clipboard"""
    tree_view.selectAll()
    tree_view.copy()
    tree_view.setPlainText("Copied to clipboard")
    QtCore.QTimer.singleShot(3000, lambda:tree_view.setPlainText(g_ascii_tree))

def saveToFile():
    """Saves ASCII tree to user system file"""
    _path = QtGui.QFileDialog.getSaveFileName()
    if _path[0]:
        save_file = QtCore.QFile(_path[0])
        if save_file.open(QtCore.QFile.ReadWrite):
            save_fileContent = QtCore.QTextStream(save_file)
            save_fileContent &lt;&lt; g_ascii_tree
            save_file.flush()
            save_file.close()
            tree_view.setPlainText("Saved to file : " + _path[0])
        else:
            tree_view.setPlainText("ERROR : Can't open file : " + _path[0])
        QtCore.QTimer.singleShot(3000, lambda:tree_view.setPlainText(g_ascii_tree))

def embedToText():
    """Stores ASCII tree into an embedded document"""
    text_doc = None
    try:
        text_doc = App.ActiveDocument.addObject("App::TextDocument","ModelTree")
    except:
        tree_view.setPlainText("ERROR : can't create Text document. Maybe your version is too old")
    if text_doc:
        text_doc.Text = g_ascii_tree
        tree_view.setPlainText("Embedded to text document : " + text_doc.Label)
    QtCore.QTimer.singleShot(3000, lambda:tree_view.setPlainText(g_ascii_tree))

def updateTxt():
    """Updates ASCII tree"""
    global g_ascii_tree
    g_ascii_tree=""
    printChildren(Gui.Selection.getSelection())
    tree_view.setPlainText(g_ascii_tree)


def onGenerate():
    """Called when updating ASCII tree"""
    p.SetString(PREF_PATTERN, gen_pattern.text())
    p.SetString(PREF_STYLE, gen_style.currentText())
    updateTxt()

# Get saved parameters or use defaults.
p = App.ParamGet(PREF_PATH)
g_name_pattern = p.GetString(PREF_PATTERN, DEF_PATTERN)
g_tree_style = p.GetString(PREF_STYLE, DEF_STYLE)
if g_tree_style not in STYLES:
    g_tree_style = DEF_STYLE

# Build UI and show
dlg = QtGui.QDialog(Gui.getMainWindow(), QtCore.Qt.Tool)
dlg_layout = QtGui.QVBoxLayout(dlg)
gen_layout = QtGui.QHBoxLayout()
gen_pattern = QtGui.QLineEdit(g_name_pattern, dlg)
gen_pattern.setToolTip("""Defined variables are :
    {LBL} : object Label
    {NAM} : object Name
    {SNAM} : object ShortName (without digits)
    {TYP} : object Type
    {BTYP} : object BaseType
    {STYP} : object ShortType (without base)
If you need to print curly braces, they have to be doubled""")
gen_run = QtGui.QPushButton("Generate",dlg)
gen_run.clicked.connect(onGenerate)
gen_style = QtGui.QComboBox(dlg)
gen_style.addItems(list(STYLES.keys()))
gen_style.setCurrentIndex(list(STYLES.keys()).index(g_tree_style))
gen_layout.addWidget(QtGui.QLabel("Generating pattern: "))
gen_layout.addWidget(gen_pattern)
gen_layout.addWidget(QtGui.QLabel("Style : "))
gen_layout.addWidget(gen_style)
gen_layout.addWidget(gen_run)
tree_view = QtGui.QPlainTextEdit(g_ascii_tree)
tree_view.setReadOnly(True)
tree_view.setMinimumWidth(Gui.getMainWindow().width()/2)
tree_view.setMinimumHeight(Gui.getMainWindow().height()/2)
tree_view.setLineWrapMode(QtGui.QPlainTextEdit.NoWrap)
button_box = QtGui.QDialogButtonBox()
copy_clip_but = QtGui.QPushButton("Copy to clipboard", button_box)
button_box.addButton(copy_clip_but, QtGui.QDialogButtonBox.ActionRole)
copy_clip_but.clicked.connect(copyToClip)
_but = QtGui.QPushButton("Save to file", button_box)
button_box.addButton(_but, QtGui.QDialogButtonBox.ActionRole)
_but.clicked.connect(saveToFile)
store_embed_but = QtGui.QPushButton("Embed in a text file", button_box)
button_box.addButton(store_embed_but, QtGui.QDialogButtonBox.ActionRole)
store_embed_but.clicked.connect(embedToText)
close_dlg_but = QtGui.QPushButton("Close", button_box)
button_box.addButton(close_dlg_but, QtGui.QDialogButtonBox.RejectRole)
button_box.rejected.connect(dlg.reject)
dlg_layout.insertLayout(0,gen_layout)
dlg_layout.addWidget(tree_view)
dlg_layout.addWidget(button_box)
updateTxt()
dlg.exec_()
</pre>
<!-- 
NewPP limit report
Cached time: 20241214203637
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.047 seconds
Real time usage: 0.104 seconds
Preprocessor visited node count: 104/1000000
Post‐expand include size: 1976/2097152 bytes
Template argument size: 282/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 7701/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   11.467      1 -total
 75.09%    8.611      1 Template:Macro/fr
 23.90%    2.741      1 Template:MacroCode
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:198908-0!canonical and timestamp 20241214203637 and revision id 1290216. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
