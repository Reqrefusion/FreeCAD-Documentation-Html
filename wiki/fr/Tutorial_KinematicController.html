<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Tutorial KinematicController/fr</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../de\Tutorial_KinematicController.html" lang="de" title="Anleitung Kinematiksteuerung (100% translated)">Deutsch</a></li>
<li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../Tutorial_KinematicController.html" lang="en" title="Tutorial KinematicController (100% translated)">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="fr">français</span></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../pl\Tutorial_KinematicController.html" lang="pl" title="Poradnik: Sterownik kinematyczny (100% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="width: 230px; float: right; margin-left: 1em">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;"><span typeof="mw:File"><span><img decoding="async" height="32" src="../File/Freecad.svg" width="32"/></span></span> Tutoriel
</td></tr>
<tr>
<th class="ctOdd">Thème
</th></tr>
<tr>
<td class="ctEven">Contrôleur cinématique créé avec Python
</td></tr>
<tr>
<th class="ctOdd">Niveau
</th></tr>
<tr>
<td class="ctEven">Des connaissances de base en Python sont utiles
</td></tr>
<tr>
<th class="ctOdd">Temps d'exécution estimé
</th></tr>
<tr>
<td class="ctEven">1 heure
</td></tr>
<tr>
<th class="ctOdd">Auteurs
</th></tr>
<tr>
<td class="ctEven"><a href="../User;FBXL5.html" title="User:FBXL5">FBXL5</a>
</td></tr>
<tr>
<th class="ctOdd">Version de FreeCAD
</th></tr>
<tr>
<td class="ctEven">0.20 et ultérieur
</td></tr>
<tr>
<th class="ctOdd">Fichiers exemples
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Sections_macro"><span class="tocnumber">2</span> <span class="toctext">Sections macro</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Structure_de_base"><span class="tocnumber">2.1</span> <span class="toctext">Structure de base</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Trouver_les_contraintes_pilotes"><span class="tocnumber">2.2</span> <span class="toctext">Trouver les contraintes pilotes</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Panneau_de_contrôle"><span class="tocnumber">2.3</span> <span class="toctext">Panneau de contrôle</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Fenêtre_principale"><span class="tocnumber">2.3.1</span> <span class="toctext">Fenêtre principale</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Paramètres_de_réglage"><span class="tocnumber">2.3.2</span> <span class="toctext">Paramètres de réglage</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#Méthode_getDriverType()"><span class="tocnumber">2.3.2.1</span> <span class="toctext">Méthode getDriverType()</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#Propriétés_de_la_fenêtre"><span class="tocnumber">2.3.2.2</span> <span class="toctext">Propriétés de la fenêtre</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-10"><a href="#Paramètres_de_réglage_supplémentaires"><span class="tocnumber">2.3.3</span> <span class="toctext">Paramètres de réglage supplémentaires</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#Labels"><span class="tocnumber">2.4</span> <span class="toctext">Labels</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#Curseur"><span class="tocnumber">2.4.1</span> <span class="toctext">Curseur</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Champs_de_saisie_de_texte"><span class="tocnumber">2.4.2</span> <span class="toctext">Champs de saisie de texte</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14"><a href="#Mouvement"><span class="tocnumber">2.5</span> <span class="toctext">Mouvement</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="#Boutons_avant_et_arrière"><span class="tocnumber">2.5.1</span> <span class="toctext">Boutons avant et arrière</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Nombre_d'étapes"><span class="tocnumber">2.5.2</span> <span class="toctext">Nombre d'étapes</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#Séquence_d'images"><span class="tocnumber">2.5.3</span> <span class="toctext">Séquence d'images</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Quelques_imperfections"><span class="tocnumber">3</span> <span class="toctext">Quelques imperfections</span></a></li>
</ul>
</div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>Ce tutoriel décrit comment générer un contrôleur cinématique simple à utiliser avec les assemblages créés avec l'<a href="../fr\Assembly3_Workbench.html" title="Assembly3 Workbench/fr">atelier Assembly3</a> à partir de quelques lignes de code Python.
</p><p>N'importe quel éditeur de texte peut être utilisé pour coder. Mon choix se porte sur Atom, mais l'éditeur intégré de FreeCAD fonctionne bien aussi.
</p><p>Les exemples de code suivants peuvent être copiés et collés dans un fichier texte vide, puis enregistrés sous le nom de votre choix comme fichier <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">*.py</span> ou <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">*.FCMacro</span>.
</p><p><span id="Macro_sections"></span>
</p>
<h2><span class="mw-headline" id="Sections_macro">Sections macro</span></h2>
<p><span id="Basic_structure"></span>
</p>
<h3><span class="mw-headline" id="Structure_de_base">Structure de base</span></h3>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2022 Your name LGPL</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
<p>La structure de base consiste en une fonction <code>main()</code> et un commutateur pour vérifier si la macro est utilisée comme un conteneur pour les classes, les méthodes, etc. ou si elle est exécutée seule. Seule la deuxième option lancera la fonction <code>main()</code>. Cette fonction est vide pour le moment.
</p><p><span id="Find_driving_constraints"></span>
</p>
<h3><span class="mw-headline" id="Trouver_les_contraintes_pilotes">Trouver les contraintes pilotes</span></h3>
<p>Les contraintes pilotes sont des objets dans un document FreeCAD. Elles doivent être marquées pour pouvoir être trouvées.
</p><p>Pour ce contrôleur, le suffixe <code>"Driver"</code> doit être attaché au label d'une contrainte pilote. Il peut être séparé par un <code>"."</code> ou <code>"-"</code> pour plus de clarté, car nous ne vérifierons que si le label se termine par <code>"Driver"</code>.
</p><p>Une fonction qui reçoit un objet document et renvoie une liste de contraintes pilotes (les noms dans ce cas) fera l'affaire.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>
</pre></div>
<p>La fonction <code>main()</code> charge le document actif dans la variable <code>kin_doc</code>, puis appelle la fonction <code>findTheDrivingConstraints()</code> et lui transmet le contenu de <code>kin_doc</code>. La liste retournée est chargée dans <code>drivers</code> qui est ensuite vérifiée pour contenir au moins un élément. Si c'est le cas, la liste est finalement imprimée dans la <a href="../fr\Report_view.html" title="Report view/fr">Vue rapport</a>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span>
</pre></div>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'à présent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><a href="#top">En haut</a></p>
<p><span id="Control_panel"></span>
</p>
<h3><span id="Panneau_de_contr.C3.B4le"></span><span class="mw-headline" id="Panneau_de_contrôle">Panneau de contrôle</span></h3>
<p>Le panneau de contrôle est construit à partir de widgets Qt, une fenêtre principale contenant plusieurs widgets d'entrée/sortie.
</p><p>Chaque widget doit être importé avant de pouvoir être utilisé, mais ils peuvent être importés en un seul ensemble. La ligne d'importation est placée en haut du fichier.
</p><p><span id="Main_window"></span>
</p>
<h4><span id="Fen.C3.AAtre_principale"></span><span class="mw-headline" id="Fenêtre_principale">Fenêtre principale</span></h4>
<p>Pour la fenêtre principale, la ligne d'importation ressemble à ceci :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">)</span>
</pre></div>
<p>La fenêtre principale appelée <code>ControlPanel</code> est un objet de classe instancié à partir du widget <code>QDialog</code>.
</p><p>Elle possède deux méthodes init. <code>__init__()</code> initialise le nouvel objet de la classe, gère les arguments entrants et lance <code>initUI()</code> qui gère tous les widgets de la fenêtre principale.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<p>Pour lancer un seul panneau de commande, une instance, appelée <code>panel</code>, de cette classe sera créée avec <code>kin_doc</code> (l'objet document) et <code>drivers[0]</code> (le premier de la liste des contraintes de conduite) transférés à cette instance. Enfin, la méthode <code>exec_()</code> de la classe ouvre la fenêtre de dialogue.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">drivers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</pre></div>
<p>Pour gérer plus d'un contrôleur (driver), nous devons vérifier la liste des contrôleurs et créer une instance pour chaque élément de la liste et transférer l'élément en cours.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
    <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
    <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
<span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</pre></div>
<p>Ces lignes remplacent la commande <code>print()</code> dans la branche else de la fonction <code>main()</code>.
</p><p>Remarque : La collecte d'une <code>panel_list</code> nous permet de lancer tous les panneaux en même temps. (Je ne peux pas encore expliquer ce comportement...)
</p><p>L'exécution de la macro affichera une fenêtre de dialogue vide et propre, en attente de widgets :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-01.png" title="Une fenêtre de dialogue vide"><img alt="Une fenêtre de dialogue vide" decoding="async" height="225" src="../File/Tutorial_KinCon-01.png" width="300"/></a></span>
</p>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'à présent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><a href="#top">En haut</a></p>
<p><span id="Setting_parameters"></span>
</p>
<h4><span id="Param.C3.A8tres_de_r.C3.A9glage"></span><span class="mw-headline" id="Paramètres_de_réglage">Paramètres de réglage</span></h4>
<p>Il est maintenant temps de remplir la méthode <code>initUI()</code> :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
<p><code>self.actuator</code> représente la contrainte pilote et <code>self.driver_type</code> stocke un mot clé pour son type. Ce dernier est utilisé pour choisir la propriété correcte avec chaque contrainte.
</p><p><span id="Method_getDriverType()"></span>
</p>
<h5><span id="M.C3.A9thode_getDriverType.28.29"></span><span class="mw-headline" id="Méthode_getDriverType()">Méthode getDriverType()</span></h5>
<p>Pour une utilisation future, nous avons besoin du type de pilote (Angle, Distance, Longueur) et donc une méthode <code>getDriverType()</code> doit être définie :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>
<span class="o">...</span>
</pre></div>
<p>Cette méthode vérifie si le type de la contrainte donnée peut être trouvé dans l'une des listes, et renvoie le type de dimension qui doit être contrôlé.
</p><p>On suppose que dans le document cinématique, le pilote est marqué correctement et fonctionne s'il était édité manuellement. Dans ce cas, il n'est pas nécessaire de filtrer les contraintes géométriques telles que Colinear ou PointsCoincidence (mais ce serait l'endroit pour le faire...).
</p><p><span id="Window_properties"></span>
</p>
<h5><span id="Propri.C3.A9t.C3.A9s_de_la_fen.C3.AAtre"></span><span class="mw-headline" id="Propriétés_de_la_fenêtre">Propriétés de la fenêtre</span></h5>
<p>La taille de la fenêtre est définie par ses dimensions minimale et maximale. En utilisant les mêmes valeurs, on obtient une taille fixe.
</p><p>Le titre indique le nom du pilote et précise s'il s'agit d'un angle, d'une distance ou d'une longueur. Enfin, on demande à la fenêtre de rester au dessus de toutes les fenêtres.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>
        <span class="c1"># now make the window visible</span>
<span class="o">...</span>
</pre></div>
<p><a href="#top">En haut</a></p>
<p><span id="Setting_more_parameters"></span>
</p>
<h4><span id="Param.C3.A8tres_de_r.C3.A9glage_suppl.C3.A9mentaires"></span><span class="mw-headline" id="Paramètres_de_réglage_supplémentaires">Paramètres de réglage supplémentaires</span></h4>
<p>L'étape suivante consiste à extraire la valeur actuelle du pilote et à définir les valeurs de début et de fin par défaut en fonction du type de pilote.
</p><p>Une distance ne peut pas être négative et exactement nulle, ce qui rend le solveur perplexe. La valeur de départ est donc fixée à 0,001. Les angles acceptent des valeurs négatives et obtiennent des valeurs symétriques. (Si les longueurs acceptent des valeurs négatives reste à prouver finalement...)
</p><p>Le suffixe de l'unité doit être conservé pour renvoyer la valeur à la propriété de la contrainte à la fin. Les distances et les longueurs nécessitent des valeurs avec des unités.
</p><p>Le traitement des unités et l'affichage des valeurs sous forme de chaînes de caractères dans plusieurs widgets nécessitent de convertir assez souvent les chiffres en chaînes de caractères et inversement.
</p><p>Pour compléter les paramètres, nous définissons un nombre de pas par défaut qui doivent être calculés lorsque le mouvement est automatisé et si le commutateur <code>self.sequence</code> est réglé sur <code>True</code>, une photo sera prise à chaque pas du mouvement.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p><a href="#top">En haut</a></p>
<p><span id="Labels"></span>
</p>
<h3><span class="mw-headline" id="Labels">Labels</span></h3>
<p>Maintenant, trois labels sont ajoutés pour afficher le début, la fin et la valeur en cours.
</p><p>Tout d'abord, la classe <code>QLabel</code> doit être importée, c'est-à-dire que la liste d'importation doit être étendue comme ceci :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">)</span>
</pre></div>
<p>Dans la méthode <code>initUI()</code>, nous insérons :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="o">...</span>
</pre></div>
<p>Le placement est fait avec la méthode héritée <code>setGeometry()</code>. Dans ce cas, la description d'un rectangle est utilisée (position X, position Y, largeur, hauteur).
</p><p>Les première et troisième lignes pourraient être combinées, mais cela n'est pas recommandé pour des raisons de clarté :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
</pre></div>
<p>L'exécution de la macro avec un document d'assemblage cinématique créerait une fenêtre de dialogue comme celle-ci :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-02.png" title="Une fenêtre de dialogue affichant la valeur de départ, la valeur en vigueur et la valeur finale."><img alt="Une fenêtre de dialogue affichant la valeur de départ, la valeur en vigueur et la valeur finale." decoding="async" height="225" src="../File/Tutorial_KinCon-02.png" width="300"/></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">La fenêtre de dialogue affiche le libellé de la contrainte et le type de pilote dans le titre, ainsi que la valeur de départ, la valeur en cours et la valeur finale sur la première ligne de la zone principale.</p>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'à présent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><a href="#top">En haut</a></p>
<p><span id="Slider"></span>
</p>
<h4><span class="mw-headline" id="Curseur">Curseur</span></h4>
<p>Pour changer la valeur courante à n'importe quel nombre entre la valeur de début et la valeur de fin, un widget de curseur conviendrait.
</p><p>Tout d'abord, la classe <code>QSlider</code> doit être importée, c'est-à-dire que la liste d'importation doit être étendue comme ceci :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">)</span>
</pre></div>
<p>De retour dans la méthode <code>initUI()</code> et juste après la section des labels, nous insérons :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Le bouton du curseur est placé avec la méthode <code>setValue()</code>. Sa valeur doit être calculée à partir de la valeur actuelle et d'un rapport de progression. Le rapport doit être calculé à chaque fois qu'une valeur de début ou de fin est modifiée. Nous insérons donc une autre méthode après la méthode <code>getDriverType()</code>.
</p><p>Travailler avec un ratio au lieu de modifier les valeurs min et max du curseur présente l'avantage d'une résolution plus fine pour les petites valeurs.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>
<span class="o">...</span>
</pre></div>
<p>Et après celle-ci, vient une autre méthode définissant ce qu'il faut faire lorsque la position du curseur ou la valeur du curseur change. La méthode <code>onActuatorSlider()</code> est appelée par la méthode <code>connect()</code> qui fournit également la valeur du curseur comme argument.
</p><p>Il recalcule la valeur courante à partir de la position du curseur, réécrit le texte du label <code>self.label_current</code> et modifie la propriété de la contrainte en fonction du type de curseur.
</p><p>L'exécution de la commande <code>"asm3CmdQuickSolve"</code> lance le solveur pour réorganiser les pièces de l'assemblage avec la valeur modifiée.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La fenêtre de dialogue avec le curseur doit ressembler à ceci et est prête à contrôler un mouvement :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-03.png" title="Deux fenêtres de dialogue avec un curseur"><img alt="Deux fenêtres de dialogue avec un curseur" decoding="async" height="225" src="../File/Tutorial_KinCon-03.png" width="300"/></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fenêtres de dialogue avec le curseur ajouté, une pour un pilote d'angle et une pour un pilote de distance</p>
<p>Nous pouvons lancer une fenêtre de dialogue pour n'importe quel document ouvert, elles n'interféreront pas entre elles.
</p>
<p><a href="#top">En haut</a></p>
<p><span id="Text_entry_fields"></span>
</p>
<h4><span class="mw-headline" id="Champs_de_saisie_de_texte">Champs de saisie de texte</span></h4>
<p>Pour définir les valeurs de début et de fin, nous utilisons un widget d'édition de ligne.
</p><p>Tout d'abord, la classe <code>QLineEdit</code> doit être importée, c'est-à-dire que la liste d'importation doit être étendue comme ceci :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">)</span>
</pre></div>
<p>De retour dans la méthode <code>initUI()</code> et entre les labels et les sections du curseur, nous insérons :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Les champs de saisie affichent les valeurs de début et de fin par défaut. Ils ne sont pas complets tant que nous n'avons pas ajouté les méthodes permettant de traiter les entrées modifiées. Ceci sera fait par les méthodes <code>self.onEntryStart()</code> et <code>self.onEntryEnd()</code> qui sont insérées entre les méthodes <code>self.stepRatio()</code> et <code>self.onActuatorSlider()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Les deux convertissent la valeur de la chaîne reçue en un nombre à virgule flottante et modifient soit <code>self.start_value</code> soit <code>self.end_value</code> et l'intitulé correspondant en conséquence. Ensuite, la valeur du curseur est mise à jour.
</p><p>La fenêtre de dialogue avec les champs de saisie de texte doit ressembler à ceci et est prête à modifier la portée d'un mouvement :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-04.png" title="Deux fenêtres de dialogue avec champs d'édition de ligne"><img alt="Deux fenêtres de dialogue avec champs d'édition de ligne" decoding="async" height="225" src="../File/Tutorial_KinCon-04.png" width="300"/></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fenêtres de dialogue avec champs d'édition de ligne, à nouveau pour un pilote d'angle et de distance</p><p>.
</p><div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'à présent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># create some input elements</span>

        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>

        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>

    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">slider_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><a href="#top">En haut</a></p>
<p><span id="Motion"></span>
</p>
<h3><span class="mw-headline" id="Mouvement">Mouvement</span></h3>
<p>Pour mettre l'assemblage en mouvement, nous avons besoin :
</p>
<ul><li>Des boutons pour déclencher le mouvement dans la direction souhaitée.</li>
<li>Un champ de saisie pour modifier le nombre de pas pour des mouvements plus rapides ou plus doux.</li>
<li>Une case à cocher pour indiquer si nous voulons prendre une séquence d'images.</li></ul>
<p><span id="Forward_and_Backward_buttons"></span>
</p>
<h4><span id="Boutons_avant_et_arri.C3.A8re"></span><span class="mw-headline" id="Boutons_avant_et_arrière">Boutons avant et arrière</span></h4>
<p>Pour déplacer automatiquement les pièces de l'assemblage, nous avons besoin de deux boutons pour déclencher les mouvements, un vers la position de départ et un vers la position d'arrivée. Ces deux boutons et un bouton de fermeture utiliseront un widget <code>QPushButton</code>.
</p><p>Les petits assemblages calculent un peu trop vite et montrent des sauts au lieu d'un mouvement régulier. Pour le ralentir, nous utilisons la méthode <code>sleep()</code> du module <code>time</code> qui doit être importé en premier.
</p><p>Another import and another widget:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">)</span>
</pre></div>
<p>Dans la méthode <code>initUI()</code>, nous insérons les boutons après la section du curseur :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&gt;-&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onForward</span><span class="p">)</span>
        <span class="c1"># backward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&lt;-&lt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onBackward</span><span class="p">)</span>
        <span class="c1"># close button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"Close window"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Les méthodes traitant des boutons enfoncés sont <code>self.onForward()</code>, <code>self.onBackward()</code>, et <code>self.onClose()</code>. Ils sont insérés après la méthode <code>onActuatorSlider()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">"Closed"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
<p>La méthode <code>self.onClose()</code> fait appel à la méthode héritée <code>self.close()</code> qui ferme simplement la fenêtre de dialogue et clôt ainsi la macro.
</p><p>Les deux <code>self.onForward()</code> et <code>self.onBackward()</code> comptent les pas qu'il reste à faire pour atteindre la position voulue et calculent la longueur d'un pas en fonction du nombre de pas. Pour l'instant, nous utilisons le nombre par défaut de 10 pas.
</p><p>Chaque tour de la boucle while augmente/diminue la valeur en cours et met à jour les valeurs du curseur qui déclenche <code>onActuatorSlider()</code> en arrière-plan (voir <a href="#Curseur">Paragraphe curseur</a>). Après une pause pour laisser l'ordinateur fournir une autre vue 3D actualisée, le décompte des étapes restantes termine la boucle.
</p><p>S'il n'y a plus de pas, le curseur est placé sur la première/dernière position du curseur, juste au cas où une erreur d'arrondi se serait produite.
</p><p>La fenêtre de dialogue avec les boutons doit ressembler à ceci et vous pouvez maintenant déplacer l'assemblage de 10 pas vers la position de début/fin souhaitée :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-05.png" title="Fenêtre de dialogue avec boutons"><img alt="Fenêtre de dialogue avec boutons" decoding="async" height="225" src="../File/Tutorial_KinCon-05.png" width="300"/></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fenêtre de dialogue avec boutons</p>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'à présent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># create some input elements</span>

        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>

        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>

        <span class="c1"># forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&gt;-&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onForward</span><span class="p">)</span>
        <span class="c1"># backward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&lt;-&lt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onBackward</span><span class="p">)</span>
        <span class="c1"># close button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"Close window"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>

    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">updateGui</span><span class="p">()</span> <span class="c1"># screen update between steps</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">"Closed"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><a href="#top">En haut</a></p>
<p><span id="Number_of_steps"></span>
</p>
<h4><span id="Nombre_d.27.C3.A9tapes"></span><span class="mw-headline" id="Nombre_d'étapes">Nombre d'étapes</span></h4>
<p>Le paramètre par défaut est d'obtenir une impression rapide si l'assemblage se déroule comme prévu sans perdre trop de temps de calcul.
</p><p>Si les pièces sautent au lieu de se déplacer en douceur, ou si les pilotes basés sur les angles ont tendance à poser des problèmes lorsque la différence entre deux angles est trop importante, ces deux problèmes peuvent être résolus en augmentant le nombre d'étapes.
</p><p>Un autre widget d'édition de ligne est donc utilisé pour modifier le nombre d'étapes (placé après les widgets d'édition de ligne existants) :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># text input field - number of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntrySteps</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La méthode connexe <code>self.onEntrySteps()</code> remplit simplement le paramètre <code>self.step_value</code> avec la valeur saisie. Elle est insérée après la méthode <code>onEntryEnd()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onEntrySteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_steps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La fenêtre de dialogue permettant de modifier le nombre d'étapes doit ressembler à ceci :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-06.png" title="Fenêtre de dialogue avec un autre champ de saisie de texte"><img alt="Fenêtre de dialogue avec un autre champ de saisie de texte" decoding="async" height="225" src="../File/Tutorial_KinCon-06.png" width="300"/></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fenêtre de dialogue avec un autre champ de saisie de texte</p>
<p><a href="#top">En haut</a></p>
<p><span id="Image_sequence"></span>
</p>
<h4><span id="S.C3.A9quence_d.27images"></span><span class="mw-headline" id="Séquence_d'images">Séquence d'images</span></h4>
<p>Lorsque le mouvement de notre assemblage répond à nos attentes, nous pouvons prendre une photo de chaque étape. La séquence d'images qui en résulte peut être utilisée pour créer une courte animation gif.
</p><p>Pour mettre en œuvre cette fonctionnalité, nous avons besoin d'un widget <code>QCheckBox</code>, et d'un répertoire pour stocker les images.
</p><p>Une importation et un widget de plus :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">)</span>
</pre></div>
<p>Dans la méthode <code>initUI()</code>, nous insérons la case à cocher après la section du curseur :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># output check box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Check to record an image sequence"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"checkBoxOutput"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onOutputClicked</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La méthode <code>onOutputClicked()</code> synchronise le paramètre <code>self.sequence</code> et l'affichage de la coche.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onOutputClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Pour définir les paramètres de sortie, nous utilisons la méthode <code>output()</code> :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">image_path</span> <span class="o">=</span> <span class="s2">".../FreeCAD/ScreenShots/Sequence"</span>
            <span class="n">file_tag</span> <span class="o">=</span> <span class="s2">".png"</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">640</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">480</span>
            <span class="n">background</span> <span class="o">=</span> <span class="s2">"Transparent"</span>
            <span class="c1"># dealing with leading zeros</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Out of Range"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"00"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="c1"># Screen shot</span>
            <span class="n">Gui</span><span class="o">.</span><span class="n">activeDocument</span><span class="p">()</span><span class="o">.</span><span class="n">activeView</span><span class="p">()</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">image_path</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="n">file_tag</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Tout d'abord, le chemin de l'image doit être adapté à votre système d'exploitation ; la dernière partie est le nom de l'image sans le numéro du moment et la balise du fichier. Ceci doit être fait manuellement pour le moment.
</p><p>Ensuite, suivent la balise du fichier pour terminer le nom de l'image, la hauteur et la largeur de l'image, et la façon dont le fond doit être rempli (<code>"Current"</code> (fond de la vue 3D), <code>"White"</code>, <code>"Black"</code>, ou <code>"Transparent"</code>).
</p><p>Pour avoir toujours un nombre à 3 chiffres, des zéros de tête doivent être préfixés au paramètre du compteur.
</p><p>Enfin, la version scriptée de la commande <span typeof="mw:File"><a class="mw-file-description" href="../File/Std_ViewScreenShot.svg"><img decoding="async" height="24" src="../File/Std_ViewScreenShot.svg" width="24"/></a></span> <a href="../fr\Std_ViewScreenShot.html" title="Std ViewScreenShot/fr">Std Capture d'écran</a> est utilisée pour prendre une photo en fonction des paramètres mentionnés.
</p><p>Toujours pas de photos prises !?! Pas de problème, car cette méthode n'est pas encore appelée, et nous devons donc insérer un appel dans la boucle while de <code>onForward()</code> et <code>onBackward()</code>. Juste après <code>time.sleep(0.2)</code>, nous insérons cette ligne :
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">steps_left</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Maintenant, la macro devrait être prête à contrôler un assemblage et à prendre des photos pour un gif animé.
</p><p>La version finale de la fenêtre de dialogue :
</p><p><span typeof="mw:File"><a class="mw-file-description" href="../File/Tutorial_KinCon-07.png" title="Fenêtre de dialogue terminée"><img alt="Fenêtre de dialogue terminée" decoding="async" height="225" src="../File/Tutorial_KinCon-07.png" width="300"/></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fenêtre de dialogue terminée</p>
<div class="mw-collapsible mw-collapsed">
<p><b>Et finalement, la macro entière</b>
</p>
<div class="mw-collapsible-content">
<p><b>N'oubliez pas de définir le chemin dans la méthode output() !</b>
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" °"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># create some input elements</span>

        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>

        <span class="c1"># text input field - number of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntrySteps</span><span class="p">)</span>

        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>

        <span class="c1"># output check box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Check to record an image sequence"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"checkBoxOutput"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onOutputClicked</span><span class="p">)</span>

        <span class="c1"># forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&gt;-&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onForward</span><span class="p">)</span>
        <span class="c1"># backward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&lt;-&lt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onBackward</span><span class="p">)</span>
        <span class="c1"># close button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"Close window"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>

    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntrySteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_steps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">updateGui</span><span class="p">()</span> <span class="c1"># screen update between steps</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">steps_left</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">steps_left</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">"Closed"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onOutputClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">image_path</span> <span class="o">=</span> <span class="s2">".../FreeCAD/ScreenShots/Sequence"</span>
            <span class="n">file_tag</span> <span class="o">=</span> <span class="s2">".png"</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">640</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">480</span>
            <span class="n">background</span> <span class="o">=</span> <span class="s2">"Transparent"</span>
            <span class="c1"># dealing with leading zeros</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Out of Range"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"00"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="c1"># Screen shot</span>
            <span class="n">Gui</span><span class="o">.</span><span class="n">activeDocument</span><span class="p">()</span><span class="o">.</span><span class="n">activeView</span><span class="p">()</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">image_path</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="n">file_tag</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><a href="#top">En haut</a></p>
<p><span id="Some_imperfections"></span>
</p>
<h2><span class="mw-headline" id="Quelques_imperfections">Quelques imperfections</span></h2>
<ul><li>L'ordre de la séquence d'images est inversé car nous utilisons la variable steps_left qui est décomptée.</li>
<li>Le répertoire et le nom de l'image sont codés en dur.</li>
<li>Les contrôleurs multiples ne sont pas synchronisés.</li></ul>
<!-- 
NewPP limit report
Cached time: 20241214204259
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.367 seconds
Real time usage: 4.979 seconds
Preprocessor visited node count: 1190/1000000
Post‐expand include size: 8579/2097152 bytes
Template argument size: 47323/2097152 bytes
Highest expansion depth: 4/100
Expensive parser function count: 37/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 221963/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00% 4634.785      1 -total
 99.48% 4610.640     37 Template:Code
  0.14%    6.310      2 Template:FileName
  0.07%    3.183     75 Template:Incode
  0.05%    2.340      1 Template:TutorialInfo/fr
  0.03%    1.354      6 Template:Caption
  0.03%    1.316     10 Template:Top
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:288093-0!canonical and timestamp 20241214204254 and revision id 1396653. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
