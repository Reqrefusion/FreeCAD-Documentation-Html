<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro TreeToAscii/it</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_TreeToAscii.html" lang="en" title="Macro TreeToAscii (100% translated)">English</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Macro_TreeToAscii.html" lang="fr" title="Macro TreeToAscii (100% translated)">français</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--stub" dir="ltr" lang="it">italiano</span></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="Macro_TreeToAscii.html" lang="pl" title="Makrodefinicja: TreeToAscii (6% translated)">polski</a></li></ul></div>
<div class="mw-translate-fuzzy">
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/Text-x-python.png" title="Icona macro generica. Crea la tua icona personale con lo stesso nome della macro"><img alt="Icona macro generica. Crea la tua icona personale con lo stesso nome della macro" decoding="async" height="32" src="../File/Text-x-python.png" srcset="/images/2/2c/Text-x-python.png 1.5x" width="32"/></a></span><span> </span>
TreeToAscii
</p>
</td></tr>
<tr>
<th class="ctOdd">Descrizione
</th></tr>
<tr>
<td class="ctEven left macro-description">Questa macro genera una rappresentazione in stile ASCII dell'albero degli oggetti selezionati<br/><br/>Versione macro: 0.6<br/>Ultima modifica: 2020-03-23<br/>Versione FreeCAD: 0.17+<br/>Autore: OpenBrain<br/>
</td></tr>
<tr>
<th class="ctOdd">Autore
</th></tr>
<tr>
<td class="ctEven macro-author"><a class="new" href="index.php?title=User;OpenBrain&amp;action=edit&amp;redlink=1.html" title="User:OpenBrain (page does not exist)">OpenBrain</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download">
</td></tr>
<tr>
<th class="ctOdd">Link
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes/it">Raccolta di macro</a><br/><a href="How_to_install_macros.html" title="How to install macros/it">Come installare le macro</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars/it">Personalizzare la  toolbar</a>
</td></tr>
<tr>
<th class="ctOdd">Versione macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.6
</td></tr>
<tr>
<th class="ctOdd">Data ultima modifica
</th></tr>
<tr>
<td class="ctEven macro-date">2020-03-23
</td></tr>
<tr>
<th class="ctOdd">Versioni di FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17+
</td></tr>
<tr>
<th class="ctOdd">Scorciatoia
</th></tr>
<tr>
<td class="ctEven"><i>Nessuna</i>
</td></tr>
<tr>
<th class="ctOdd">Vedere anche
</th></tr>
<tr>
<td class="ctEven">
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Descrizione"><span class="tocnumber">1</span> <span class="toctext">Descrizione</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Utilizzo"><span class="tocnumber">1.1</span> <span class="toctext">Utilizzo</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Script"><span class="tocnumber">3</span> <span class="toctext">Script</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Forum_discussion"><span class="tocnumber">3.1</span> <span class="toctext">Forum discussion</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Code"><span class="tocnumber">3.2</span> <span class="toctext">Code</span></a></li>
</ul>
</li>
</ul>
</div>
</td></tr>
</tbody></table>
</div>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Descrizione">Descrizione</span></h2>
<div class="mw-translate-fuzzy">
<p>Questa macro è stata scritta principalmente per documentare la costruzione del modello.
Genera una rappresentazione in stile ASCII dell'albero di costruzione degli oggetti selezionati.
</p>
</div>
<p><span id="Usage"></span>
</p>
<div class="mw-translate-fuzzy">
<h3><span class="mw-headline" id="Utilizzo">Utilizzo</span></h3>
</div>
<p>Just select the object(s) you want to print the tree and run the macro. It will display the tree of each object in a dialog. All selected objects will be considered as being at the same hierarchy level at the top of the tree (even if they aren't in the real model). Once dialog is open, you can change style and/or pattern and re-generate the ASCII tree.
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/FCTree2Ascii.png"><img decoding="async" height="487" src="../File/FCTree2Ascii.png" width="949"/></a></span>
</p><p>Several styles are provided, at this time mainly to support systems that can encounter problems with Unicode encoding :
</p>
<ul><li><i><b>Modern</b></i> : (default) uses Unicode characters to display forks and branches</li>
<li><i><b>Baroque</b></i> : another Unicode style with larger indentation</li>
<li><i><b>ASCII</b></i> : pure ASCII representation of forks and branches</li></ul>
<p>Creating your own style should not be too difficult by editing the macro and changing/adding a style to 'STYLES' variable. Selected style choice is saved in FreeCAD parameters.
</p><p>Line pattern is can be customized. It supports different defined metadata :
</p>
<ul><li><i><b>{LBL}</b></i> : object Label (displayed label)</li>
<li><i><b>{NAM}</b></i> : object Name (internal name) eg. 'Box001'</li>
<li><i><b>{SNAM}</b></i> : object ShortName (without digits) eg. 'Box001' will be displayed as 'Box'</li>
<li><i><b>{TYP}</b></i> : object Type eg. 'Part::MultiFuse'</li>
<li><i><b>{BTYP}</b></i> : object BaseType eg. 'Part::MultiFuse' will be displayed as 'Part'</li>
<li><i><b>{STYP}</b></i> : object ShortType (without base) eg. 'Part::MultiFuse' will be displayed as 'MultiFuse'</li></ul>
<p>Default pattern is '{LBL} ({SNAM})', which means eg. object 'Box001' labeled 'myCube' will be displayed as 'myCube (Box001)'.
Notice virtually all characters are allowed. If you want to print curly braces, they need to be doubled. Eg. with same example object, pattern '{LBL} (SNAME) {{{TYP}}} =&gt;' will print 'myCube (Box) {Part::Box} =&gt;'. Available metadata are available in the tooltip of the pattern editing field so you don't need to remember it. Line pattern is saved in FreeCAD parameters.
</p><p>Once dialog is open, several actions are available :
</p>
<ul><li><i><b>Copy to clipboard</b></i> : copies the whole tree to your clipboard</li>
<li><i><b>Save to file</b></i> : saves the whole tree to an arbitrary file on your system</li>
<li><i><b>Embed in text file</b></i> : stores the whole tree in a text file embedded in the document (available since FC 0.18.4)</li>
<li>Of course you can copy any part of the tree by selecting it and using standard copy commands</li></ul>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>The macro is available through <a href="Std_AddonMgr.html" title="Std AddonMgr">Addon Manager</a>.
Code is provided on this page for convenience in case user system doesn't have git-python. Though it should be up-to-date, latest release is always available at <a class="external text" href="https://github.com/FreeCAD/FreeCAD-macros/blob/master/Information/TreeToAscii.FCMacro" rel="nofollow">FreeCAD-macro repository</a>
</p><p>For more detailed explanations, see the <a href="How_to_install_macros.html" title="How to install macros">How to install macros</a> page.
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<h3><span class="mw-headline" id="Forum_discussion">Forum discussion</span></h3>
<p>For any feedback (bug, feature request, comments, ...), please use this forum thread : <a class="external free" href="https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=43504" rel="nofollow">https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=43504</a>
</p>
<h3><span class="mw-headline" id="Code">Code</span></h3>
<p><b>Macro_FCTree2Ascii.FCMacro</b>
</p>
<pre>#!/usr/bin/python
#####################################
# Copyright (c) openBrain 2020
# Licensed under LGPL v2
#
# This FreeCAD macro prints the Tree of selected object(s) as ASCII art.
# Several styles are available. Tree branch pattern is customizable.
# It can export to clipboard, file or embedded text document.
# This mainly aims at documenting the model.
#
# Version history :
# *0.6 : introduce last fork string definition, add new style
# *0.5 : beta release
#
#####################################

# -*- coding: utf-8 -*-

__Name__ = 'TreeToAscii'
__Comment__ = 'Prints the Tree of selected object(s) as ASCII art'
__Author__ = 'openBrain'
__Version__ = '0.6'
__Date__ = '2020-03-23'
__License__ = 'LGPL v2'
__Web__ = 'https://www.freecadweb.org/wiki/Macro_TreeToAscii'
__Wiki__ = 'https://www.freecadweb.org/wiki/Macro_TreeToAscii'
__Icon__ = ''
__Help__ = 'Select object(s) you want to print the tree then run'
__Status__ = 'Beta'
__Requires__ = 'FreeCAD &gt;= 0.17'
__Communication__ = 'https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=43504'

import FreeCAD as App
import FreeCADGui as Gui
from PySide import QtGui, QtCore  # Special FreeCAD's PySide, which may be PySide2!

PREF_PATH = 'User parameter:BaseApp/Preferences/Mod/TreeToAscii'
PREF_PATTERN = 'TreePattern'
PREF_STYLE = 'TreeStyle'
STYLES = {  # defines styles as NAME : [ branch str, fork str, opt:last fork str]
    'Modern' : [' │ ', ' ├ ', ' └ '],  # Unicode U+251C, Unicode U+2502
    'Baroque' : [' │  ', ' ├─ ',  ' └─ '],
    'ASCII' : [' | ', ' \\_']
    }
DEF_PATTERN = '{LBL} ({SNAM})'
DEF_STYLE = list(STYLES.keys())[0]

g_ascii_tree=""

def printChildren(objs=None, level=0, baseline=''):
    """Build ASCII tree by recursive call"""
    global g_ascii_tree
    for cnt, obj in enumerate(objs,1):
        data = {
            "LBL" : obj.Label,
            "NAM" : obj.Name,
            "SNAM" : "".join(filter(str.isalpha, obj.Name)),
            "TYP" : obj.TypeId,
            "BTYP" : obj.TypeId.partition('::')[0],
            "STYP" : obj.TypeId.rpartition('::')[-1]
        }
        branch_str = STYLES[gen_style.currentText()][0]
        fork_str = STYLES[gen_style.currentText()][1]
        last_fork_str = STYLES[gen_style.currentText()][-1]
        if cnt == len(objs):
            g_ascii_tree += baseline + last_fork_str
        else:
            g_ascii_tree += baseline + fork_str
        try:
            g_ascii_tree += gen_pattern.text().format(**data)
        except (ValueError, IndexError, KeyError):
            g_ascii_tree = 'Error in generating pattern'
            return
        g_ascii_tree += '\n'
        if cnt == len(objs):
            baselinechi = baseline + ' '*len(branch_str)
        else:
            baselinechi = baseline + branch_str
        printChildren(obj.ViewObject.claimChildren(), level + 1, baselinechi)

def copyToClip():
    """Copies ASCII tree to clipboard"""
    tree_view.selectAll()
    tree_view.copy()
    tree_view.setPlainText("Copied to clipboard")
    QtCore.QTimer.singleShot(3000, lambda:tree_view.setPlainText(g_ascii_tree))

def saveToFile():
    """Saves ASCII tree to user system file"""
    _path = QtGui.QFileDialog.getSaveFileName()
    if _path[0]:
        save_file = QtCore.QFile(_path[0])
        if save_file.open(QtCore.QFile.ReadWrite):
            save_fileContent = QtCore.QTextStream(save_file)
            save_fileContent &lt;&lt; g_ascii_tree
            save_file.flush()
            save_file.close()
            tree_view.setPlainText("Saved to file : " + _path[0])
        else:
            tree_view.setPlainText("ERROR : Can't open file : " + _path[0])
        QtCore.QTimer.singleShot(3000, lambda:tree_view.setPlainText(g_ascii_tree))

def embedToText():
    """Stores ASCII tree into an embedded document"""
    text_doc = None
    try:
        text_doc = App.ActiveDocument.addObject("App::TextDocument","ModelTree")
    except:
        tree_view.setPlainText("ERROR : can't create Text document. Maybe your version is too old")
    if text_doc:
        text_doc.Text = g_ascii_tree
        tree_view.setPlainText("Embedded to text document : " + text_doc.Label)
    QtCore.QTimer.singleShot(3000, lambda:tree_view.setPlainText(g_ascii_tree))

def updateTxt():
    """Updates ASCII tree"""
    global g_ascii_tree
    g_ascii_tree=""
    printChildren(Gui.Selection.getSelection())
    tree_view.setPlainText(g_ascii_tree)


def onGenerate():
    """Called when updating ASCII tree"""
    p.SetString(PREF_PATTERN, gen_pattern.text())
    p.SetString(PREF_STYLE, gen_style.currentText())
    updateTxt()

# Get saved parameters or use defaults.
p = App.ParamGet(PREF_PATH)
g_name_pattern = p.GetString(PREF_PATTERN, DEF_PATTERN)
g_tree_style = p.GetString(PREF_STYLE, DEF_STYLE)
if g_tree_style not in STYLES:
    g_tree_style = DEF_STYLE

# Build UI and show
dlg = QtGui.QDialog(Gui.getMainWindow(), QtCore.Qt.Tool)
dlg_layout = QtGui.QVBoxLayout(dlg)
gen_layout = QtGui.QHBoxLayout()
gen_pattern = QtGui.QLineEdit(g_name_pattern, dlg)
gen_pattern.setToolTip("""Defined variables are :
    {LBL} : object Label
    {NAM} : object Name
    {SNAM} : object ShortName (without digits)
    {TYP} : object Type
    {BTYP} : object BaseType
    {STYP} : object ShortType (without base)
If you need to print curly braces, they have to be doubled""")
gen_run = QtGui.QPushButton("Generate",dlg)
gen_run.clicked.connect(onGenerate)
gen_style = QtGui.QComboBox(dlg)
gen_style.addItems(list(STYLES.keys()))
gen_style.setCurrentIndex(list(STYLES.keys()).index(g_tree_style))
gen_layout.addWidget(QtGui.QLabel("Generating pattern: "))
gen_layout.addWidget(gen_pattern)
gen_layout.addWidget(QtGui.QLabel("Style : "))
gen_layout.addWidget(gen_style)
gen_layout.addWidget(gen_run)
tree_view = QtGui.QPlainTextEdit(g_ascii_tree)
tree_view.setReadOnly(True)
tree_view.setMinimumWidth(Gui.getMainWindow().width()/2)
tree_view.setMinimumHeight(Gui.getMainWindow().height()/2)
tree_view.setLineWrapMode(QtGui.QPlainTextEdit.NoWrap)
button_box = QtGui.QDialogButtonBox()
copy_clip_but = QtGui.QPushButton("Copy to clipboard", button_box)
button_box.addButton(copy_clip_but, QtGui.QDialogButtonBox.ActionRole)
copy_clip_but.clicked.connect(copyToClip)
_but = QtGui.QPushButton("Save to file", button_box)
button_box.addButton(_but, QtGui.QDialogButtonBox.ActionRole)
_but.clicked.connect(saveToFile)
store_embed_but = QtGui.QPushButton("Embed in a text file", button_box)
button_box.addButton(store_embed_but, QtGui.QDialogButtonBox.ActionRole)
store_embed_but.clicked.connect(embedToText)
close_dlg_but = QtGui.QPushButton("Close", button_box)
button_box.addButton(close_dlg_but, QtGui.QDialogButtonBox.RejectRole)
button_box.rejected.connect(dlg.reject)
dlg_layout.insertLayout(0,gen_layout)
dlg_layout.addWidget(tree_view)
dlg_layout.addWidget(button_box)
updateTxt()
dlg.exec_()
</pre>
<!-- 
NewPP limit report
Cached time: 20241129211309
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.042 seconds
Real time usage: 0.050 seconds
Preprocessor visited node count: 112/1000000
Post‐expand include size: 2200/2097152 bytes
Template argument size: 250/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 7702/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    3.375      1 -total
 70.10%    2.366      1 Template:Macro/it
 26.99%    0.911      1 Template:MacroCode
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:208264-0!canonical and timestamp 20241129211309 and revision id 1290081. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
